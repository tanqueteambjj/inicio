<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tanque Team Jiu-Jitsu | Matr√≠cula Online</title>
    
    <!-- Favicon -->
    <link rel="icon" href="https://i.ibb.co/spgfD2Nd/1771300330359.png" type="image/png">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;600;700&family=Roboto:wght@300;400;500;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, doc, deleteDoc, updateDoc, query, orderBy, where } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        try {
            const manualConfig = {
                apiKey: "AIzaSyCWlrrfNn6q4GhhL2H7goHjQMd3MsprxOE",
                authDomain: "tanqueteambjj.firebaseapp.com",
                projectId: "tanqueteambjj",
                storageBucket: "tanqueteambjj.firebasestorage.app",
                messagingSenderId: "410605992451",
                appId: "1:410605992451:web:f0f341f4594fe75f376c36",
                measurementId: "G-SW8PP8X7WM"
            };

            const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : manualConfig;
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'tanqueteam-bjj';

            const isConfigured = firebaseConfig && firebaseConfig.apiKey !== "SUA_API_KEY_AQUI";

            if (isConfigured) {
                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app);
                const db = getFirestore(app);

                const initAuth = async () => {
                    try {
                        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                            await signInWithCustomToken(auth, __initial_auth_token);
                        } else {
                            await signInAnonymously(auth);
                        }
                    } catch (e) {
                        console.error("Erro na autentica√ß√£o Firebase:", e);
                    }
                };
                initAuth();

                window.db = db;
                window.collection = collection;
                window.addDoc = addDoc;
                window.getDocs = getDocs;
                window.deleteDoc = deleteDoc;
                window.updateDoc = updateDoc;
                window.doc = doc;
                window.query = query;
                window.orderBy = orderBy;
                window.where = where;
                window.appId = appId;
                window.firebaseInitialized = true;
            } else {
                console.warn("Firebase Config n√£o configurada corretamente.");
                window.firebaseInitialized = false;
            }
        } catch (error) {
            console.error("Erro cr√≠tico ao inicializar Firebase:", error);
            window.firebaseInitialized = false;
        }
    </script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            red: '#D90429',
                            dark: '#1B1B1B',
                            gray: '#2B2D42',
                            light: '#EDF2F4'
                        }
                    },
                    fontFamily: {
                        sans: ['Roboto', 'sans-serif'],
                        display: ['Oswald', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    }
                }
            }
        }
    </script>

    <style>
        .hero-bg {
            background-image: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('https://images.unsplash.com/photo-1564415315949-7a0c4c73aab4?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        
        .signature-font {
            font-family: 'Brush Script MT', cursive;
            font-size: 1.5rem;
            color: #000;
        }

        .contract-scroll::-webkit-scrollbar { width: 8px; }
        .contract-scroll::-webkit-scrollbar-track { background: #f1f1f1; }
        .contract-scroll::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        .contract-scroll::-webkit-scrollbar-thumb:hover { background: #555; }

        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        @media print {
            @page { margin: 1cm; size: auto; }
            nav, #home, #about, #schedule, #plans, #register, footer, #successModal, #confirmationModal, .no-print { display: none !important; }
            body { background: white; padding: 0; margin: 0; }

            /* Contract Mode */
            body:not(.printing-report) #printable-contract {
                position: absolute; left: 0; top: 0; width: 100%; display: block !important; visibility: visible;
                background: white; color: black; padding: 0; margin: 0; font-size: 10pt; line-height: 1.3;
            }
            body:not(.printing-report) #printable-contract * { visibility: visible; }
            
            #printable-contract h1 { font-size: 18pt; margin-bottom: 0.2rem; }
            #printable-contract h2 { font-size: 12pt; margin-bottom: 1rem; margin-top: 0.5rem; }
            #printable-contract .header-section { margin-bottom: 1rem; border-bottom-width: 1px; padding-bottom: 0.5rem; }
            #printable-contract .parties-section { margin-bottom: 1rem; font-size: 9pt; }
            #printable-contract .clauses-section { margin-bottom: 1rem; gap: 0.5rem; }
            #printable-contract .clauses-section p { margin-bottom: 0.5rem; text-align: justify; }
            #printable-contract .signatures-section { margin-top: 2rem; }
        }
    </style>
</head>
<body class="bg-brand-light text-slate-800 font-sans antialiased">

    <!-- Navigation -->
    <nav class="bg-brand-dark text-white sticky top-0 z-50 shadow-lg">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <img src="https://i.ibb.co/spgfD2Nd/1771300330359.png" alt="Tanque Team Logo" class="w-12 h-12 object-contain filter drop-shadow-md">
                <span class="font-display text-2xl font-bold tracking-wider">TANQUE TEAM <span class="text-brand-red">BJJ</span></span>
            </div>
            
            <!-- Desktop Menu -->
            <div class="hidden md:flex items-center space-x-6 font-display uppercase tracking-wide text-sm">
                <a href="#home" class="hover:text-brand-red transition">In√≠cio</a>
                <a href="#about" class="hover:text-brand-red transition">A Metodologia</a>
                <a href="#schedule" class="hover:text-brand-red transition">Hor√°rios</a>
                <a href="#plans" class="hover:text-brand-red transition">Planos</a>
                <!-- Link √Årea do Aluno com Destaque -->
                <a href="https://tanqueteambjj.github.io/inicio/login_aluno.html" class="bg-white text-brand-dark px-4 py-2 rounded font-bold hover:bg-gray-200 transition shadow-sm border border-gray-300 flex items-center gap-2">
                    <i class="fa-solid fa-user-lock"></i> √Årea do Aluno
                </a>
                <a href="#register" class="bg-brand-red px-5 py-2 rounded text-white hover:bg-red-700 transition">Matricule-se Agora</a>
            </div>

            <!-- Mobile Menu Button -->
            <button id="mobile-menu-btn" class="md:hidden text-2xl focus:outline-none"><i class="fa-solid fa-bars"></i></button>
        </div>
        
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-brand-dark pb-4 px-6 space-y-2">
            <a href="#home" class="block py-2 hover:text-brand-red">In√≠cio</a>
            <a href="#about" class="block py-2 hover:text-brand-red">A Metodologia</a>
            <a href="#schedule" class="block py-2 hover:text-brand-red">Hor√°rios</a>
            <a href="#plans" class="block py-2 hover:text-brand-red">Planos</a>
            <a href="https://tanqueteambjj.github.io/inicio/login_aluno.html" class="block py-2 text-white font-bold bg-gray-700 px-3 rounded"><i class="fa-solid fa-user-lock mr-2"></i>√Årea do Aluno</a>
            <a href="#register" class="block py-2 text-brand-red font-bold">Matricule-se</a>
        </div>
    </nav>

    <!-- Hero Section -->
    <section id="home" class="hero-bg h-screen flex items-center justify-center text-center px-4">
        <div class="max-w-4xl text-white fade-in">
            <h2 class="font-display text-lg md:text-2xl mb-4 tracking-widest uppercase text-brand-red">Disciplina ‚Ä¢ Respeito ‚Ä¢ T√©cnica</h2>
            <h1 class="font-display text-5xl md:text-7xl font-bold mb-6 leading-tight">DOMINE A <br>ARTE SUAVE</h1>
            <p class="text-gray-300 text-lg md:text-xl mb-8 max-w-2xl mx-auto">N√£o √© sobre for√ßa, √© sobre alavanca. Transforme sua mente e corpo na maior academia de Jiu-Jitsu da regi√£o.</p>
            <div class="flex flex-col md:flex-row gap-4 justify-center">
                <a href="#register" class="bg-brand-red text-white px-8 py-4 rounded font-bold font-display uppercase tracking-wider hover:bg-red-700 transition shadow-lg transform hover:-translate-y-1">Come√ßar Hoje</a>
                <a href="#about" class="border-2 border-white text-white px-8 py-4 rounded font-bold font-display uppercase tracking-wider hover:bg-white hover:text-brand-dark transition">Saiba Mais</a>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="py-20 bg-white">
        <div class="container mx-auto px-6">
            <div class="text-center mb-16">
                <h2 class="font-display text-4xl font-bold text-brand-dark mb-4">POR QUE A TANQUE TEAM?</h2>
                <div class="w-24 h-1 bg-brand-red mx-auto"></div>
            </div>
            <div class="grid md:grid-cols-3 gap-10">
                <div class="text-center p-6 border border-gray-100 rounded-xl shadow-sm hover:shadow-xl transition duration-300">
                    <div class="w-16 h-16 bg-brand-light rounded-full flex items-center justify-center mx-auto mb-6 text-brand-red text-2xl"><i class="fa-solid fa-user-ninja"></i></div>
                    <h3 class="font-display text-xl font-bold mb-3">Professores Faixa Preta</h3>
                    <p class="text-gray-600">Aprenda diretamente com mestres certificados e com experi√™ncia em competi√ß√µes internacionais.</p>
                </div>
                <div class="text-center p-6 border border-gray-100 rounded-xl shadow-sm hover:shadow-xl transition duration-300">
                    <div class="w-16 h-16 bg-brand-light rounded-full flex items-center justify-center mx-auto mb-6 text-brand-red text-2xl"><i class="fa-solid fa-shield-heart"></i></div>
                    <h3 class="font-display text-xl font-bold mb-3">Ambiente Seguro</h3>
                    <p class="text-gray-600">Foco total no respeito e na integridade f√≠sica do aluno. O Jiu-Jitsu √© para todos.</p>
                </div>
                <div class="text-center p-6 border border-gray-100 rounded-xl shadow-sm hover:shadow-xl transition duration-300">
                    <div class="w-16 h-16 bg-brand-light rounded-full flex items-center justify-center mx-auto mb-6 text-brand-red text-2xl"><i class="fa-solid fa-child-reaching"></i></div>
                    <h3 class="font-display text-xl font-bold mb-3">Metodologia Infantil</h3>
                    <p class="text-gray-600">Programas anti-bullying e desenvolvimento de autoconfian√ßa para crian√ßas a partir de 4 anos.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Schedule Section -->
    <section id="schedule" class="py-20 bg-brand-dark text-white border-t border-gray-800">
        <div class="container mx-auto px-6">
            <div class="text-center mb-16">
                <h2 class="font-display text-4xl font-bold mb-4">GRADE DE <span class="text-brand-red">HOR√ÅRIOS</span></h2>
                <div class="w-24 h-1 bg-brand-red mx-auto"></div>
                <p class="mt-4 text-gray-400 text-sm italic">* Hor√°rios sujeitos a altera√ß√µes.</p>
            </div>

            <div class="grid lg:grid-cols-2 gap-10 max-w-6xl mx-auto">
                <!-- Adulto -->
                <div class="bg-gray-800 rounded-xl overflow-hidden shadow-2xl border border-gray-700">
                    <div class="bg-brand-red py-4 text-center">
                        <h3 class="font-display text-2xl font-bold tracking-wider">ADULTO</h3>
                    </div>
                    <div class="p-6 overflow-x-auto">
                        <table class="w-full text-center border-collapse min-w-[400px]">
                            <thead>
                                <tr class="text-gray-400 border-b border-gray-700 text-sm md:text-base">
                                    <th class="pb-3 w-1/5">SEG</th>
                                    <th class="pb-3 w-1/5">TER</th>
                                    <th class="pb-3 w-1/5">QUA</th>
                                    <th class="pb-3 w-1/5">QUI</th>
                                    <th class="pb-3 w-1/5">SEX</th>
                                </tr>
                            </thead>
                            <tbody class="text-lg font-medium">
                                <tr class="border-b border-gray-700">
                                    <td class="py-4">10h30</td>
                                    <td class="py-4 text-gray-600">-</td>
                                    <td class="py-4">10h30</td>
                                    <td class="py-4 text-gray-600">-</td>
                                    <td class="py-4">10h30</td>
                                </tr>
                                <tr class="border-b border-gray-700">
                                    <td class="py-4 text-gray-600">-</td>
                                    <td class="py-4">12h30</td>
                                    <td class="py-4 text-gray-600">-</td>
                                    <td class="py-4">12h30</td>
                                    <td class="py-4 text-gray-600">-</td>
                                </tr>
                                <tr class="border-b border-gray-700">
                                    <td class="py-4">18h00</td>
                                    <td class="py-4 text-gray-600">-</td>
                                    <td class="py-4">18h00</td>
                                    <td class="py-4 text-gray-600">-</td>
                                    <td class="py-4">18h00</td>
                                </tr>
                                <tr>
                                    <td class="py-4 text-gray-600">-</td>
                                    <td class="py-4">21h00</td>
                                    <td class="py-4 text-gray-600">-</td>
                                    <td class="py-4">21h00</td>
                                    <td class="py-4 text-gray-600">-</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Infantil -->
                <div class="bg-gray-800 rounded-xl overflow-hidden shadow-2xl border border-gray-700">
                    <div class="bg-blue-600 py-4 text-center">
                        <h3 class="font-display text-2xl font-bold tracking-wider">INFANTIL</h3>
                    </div>
                    <div class="p-6 overflow-x-auto">
                        <table class="w-full text-center border-collapse min-w-[400px]">
                            <thead>
                                <tr class="text-gray-400 border-b border-gray-700 text-sm md:text-base">
                                    <th class="pb-3 w-1/5">SEG</th>
                                    <th class="pb-3 w-1/5">TER</th>
                                    <th class="pb-3 w-1/5">QUA</th>
                                    <th class="pb-3 w-1/5">QUI</th>
                                    <th class="pb-3 w-1/5">SEX</th>
                                </tr>
                            </thead>
                            <tbody class="text-lg font-medium">
                                <tr class="border-b border-gray-700">
                                    <td class="py-4 text-gray-600">-</td>
                                    <td class="py-4">15h00</td>
                                    <td class="py-4 text-gray-600">-</td>
                                    <td class="py-4">15h00</td>
                                    <td class="py-4">15h00</td>
                                </tr>
                                <tr>
                                    <td class="py-4">16h30</td>
                                    <td class="py-4 text-gray-600">-</td>
                                    <td class="py-4">16h30</td>
                                    <td class="py-4 text-gray-600">-</td>
                                    <td class="py-4">16h30</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Plans Section -->
    <section id="plans" class="py-20 bg-gray-50">
        <div class="container mx-auto px-6">
            <div class="text-center mb-10">
                <h2 class="font-display text-4xl font-bold text-brand-dark mb-4">ESCOLHA SEU PLANO</h2>
                <div class="bg-brand-red text-white py-3 px-6 rounded-lg inline-block shadow-lg animate-pulse">
                    <h3 class="font-bold uppercase tracking-wider text-sm md:text-base">üéâ M√™s de Inaugura√ß√£o üéâ</h3>
                    <p class="text-xs md:text-sm mt-1 font-medium">1¬∫ M√™s por apenas <strong>R$ 29,90</strong> em qualquer plano Semestral!</p>
                </div>
            </div>
            
            <!-- Planos Individuais -->
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-7xl mx-auto mb-10">
                <!-- Plan 1: Infantil Mensal -->
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden border-t-4 border-gray-400 hover:shadow-xl transition duration-300 flex flex-col">
                    <div class="p-6 text-center flex-grow">
                        <h3 class="font-display text-xl font-bold text-gray-800 mb-1">INFANTIL</h3>
                        <p class="text-gray-500 text-xs font-bold uppercase mb-4 tracking-wide">Plano Mensal</p>
                        <div class="text-3xl font-bold text-brand-dark mb-4">R$ 189,90<span class="text-sm text-gray-400 font-normal">/m√™s</span></div>
                        <ul class="text-left space-y-2 mb-6 text-gray-600 text-xs">
                            <li class="flex items-center"><i class="fa-solid fa-check text-green-500 mr-2"></i> Metodologia Especializada</li>
                            <li class="flex items-center"><i class="fa-solid fa-check text-green-500 mr-2"></i> Desenvolvimento Disciplinar</li>
                            <li class="flex items-center"><i class="fa-solid fa-check text-green-500 mr-2"></i> Sem fidelidade</li>
                        </ul>
                        <p class="text-xs text-gray-400 mt-4 pt-4 border-t border-gray-100 font-medium">Idade: 4 a 11 anos</p>
                    </div>
                    <div class="p-6 pt-0"><button onclick="selectPlan('infantil-mensal', '189,90')" class="w-full py-2 border-2 border-brand-dark text-brand-dark font-bold rounded hover:bg-brand-dark hover:text-white transition">Selecionar</button></div>
                </div>
                <!-- Plan 2: Infantil Trimestral -->
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden border-t-4 border-brand-dark relative hover:shadow-xl transition duration-300 flex flex-col">
                    <div class="absolute top-0 right-0 bg-brand-dark text-white text-[10px] font-bold px-2 py-1 rounded-bl">OFERTA</div>
                    <div class="p-6 text-center flex-grow">
                        <h3 class="font-display text-xl font-bold text-gray-800 mb-1">INFANTIL</h3>
                        <p class="text-gray-500 text-xs font-bold uppercase mb-4 tracking-wide">Plano Trimestral</p>
                        <div class="text-3xl font-bold text-brand-dark mb-4">R$ 168,90<span class="text-sm text-gray-400 font-normal">/m√™s</span></div>
                        <ul class="text-left space-y-2 mb-6 text-gray-600 text-xs">
                            <li class="flex items-center"><i class="fa-solid fa-check text-green-500 mr-2"></i> Custo Intermedi√°rio</li>
                            <li class="flex items-center"><i class="fa-solid fa-check text-green-500 mr-2"></i> Desenvolvimento Cont√≠nuo</li>
                            <li class="flex items-center"><i class="fa-solid fa-check text-green-500 mr-2"></i> Fidelidade 3 Meses</li>
                        </ul>
                        <p class="text-xs text-gray-400 mt-4 pt-4 border-t border-gray-100 font-medium">Idade: 4 a 11 anos</p>
                    </div>
                    <div class="p-6 pt-0"><button onclick="selectPlan('infantil-trimestral', '168,90')" class="w-full py-2 border-2 border-brand-dark text-brand-dark font-bold rounded hover:bg-brand-dark hover:text-white transition">Selecionar</button></div>
                </div>
                <!-- Plan 3: Infantil Semestral -->
                <div class="bg-white rounded-2xl shadow-xl overflow-hidden border-t-4 border-brand-red transform md:-translate-y-2 relative flex flex-col">
                    <div class="absolute top-0 right-0 bg-brand-red text-white text-[10px] font-bold px-2 py-1 rounded-bl z-10">MAIS VANTAJOSO</div>
                    <div class="p-6 text-center flex-grow">
                        <h3 class="font-display text-xl font-bold text-brand-red mb-1">INFANTIL</h3>
                        <p class="text-gray-500 text-xs font-bold uppercase mb-4 tracking-wide">Plano Semestral</p>
                        <div class="text-3xl font-bold text-brand-dark mb-2">R$ 29,90<span class="text-sm text-gray-400 font-normal"> (1¬∫ m√™s)</span></div>
                        <div class="mb-4 bg-green-50 py-2 px-1 rounded border border-green-200">
                            <p class="text-xs text-green-700 font-bold">A partir do 2¬∫ m√™s: R$ 157,90/m√™s</p>
                        </div>
                        <ul class="text-left space-y-2 mb-6 text-gray-600 text-xs">
                            <li class="flex items-center"><i class="fa-solid fa-check text-green-500 mr-2"></i> Melhor Valor Mensal</li>
                            <li class="flex items-center"><i class="fa-solid fa-check text-green-500 mr-2"></i> Camiseta Gr√°tis</li>
                            <li class="flex items-center"><i class="fa-solid fa-check text-green-500 mr-2"></i> Fidelidade 6 Meses</li>
                        </ul>
                        <p class="text-xs text-gray-400 mt-4 pt-4 border-t border-gray-100 font-medium">Idade: 4 a 11 anos</p>
                    </div>
                    <div class="p-6 pt-0"><button onclick="selectPlan('infantil-semestral', '157,90')" class="w-full py-2 bg-brand-red text-white font-bold rounded hover:bg-red-700 transition shadow-lg">Selecionar</button></div>
                </div>
                
                <!-- Plan 4: Jovem/Adulto Mensal -->
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden border-t-4 border-gray-400 hover:shadow-xl transition duration-300 flex flex-col">
                    <div class="p-6 text-center flex-grow">
                        <h3 class="font-display text-xl font-bold text-gray-800 mb-1">JOVEM/ADULTO</h3>
                        <p class="text-gray-500 text-xs font-bold uppercase mb-4 tracking-wide">Plano Mensal</p>
                        <div class="text-3xl font-bold text-brand-dark mb-4">R$ 168,90<span class="text-sm text-gray-400 font-normal">/m√™s</span></div>
                        <ul class="text-left space-y-2 mb-6 text-gray-600 text-xs">
                            <li class="flex items-center"><i class="fa-solid fa-check text-green-500 mr-2"></i> Acesso Livre</li>
                            <li class="flex items-center"><i class="fa-solid fa-check text-green-500 mr-2"></i> Todos os Hor√°rios</li>
                            <li class="flex items-center"><i class="fa-solid fa-check text-green-500 mr-2"></i> Sem fidelidade</li>
                        </ul>
                        <p class="text-xs text-gray-400 mt-4 pt-4 border-t border-gray-100 font-medium">Idade: 12 anos ou mais</p>
                    </div>
                    <div class="p-6 pt-0"><button onclick="selectPlan('adulto-mensal', '168,90')" class="w-full py-2 border-2 border-brand-dark text-brand-dark font-bold rounded hover:bg-brand-dark hover:text-white transition">Selecionar</button></div>
                </div>
                <!-- Plan 5: Jovem/Adulto Trimestral -->
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden border-t-4 border-brand-dark relative hover:shadow-xl transition duration-300 flex flex-col">
                    <div class="absolute top-0 right-0 bg-brand-dark text-white text-[10px] font-bold px-2 py-1 rounded-bl">OFERTA</div>
                    <div class="p-6 text-center flex-grow">
                        <h3 class="font-display text-xl font-bold text-gray-800 mb-1">JOVEM/ADULTO</h3>
                        <p class="text-gray-500 text-xs font-bold uppercase mb-4 tracking-wide">Plano Trimestral</p>
                        <div class="text-3xl font-bold text-brand-dark mb-4">R$ 147,90<span class="text-sm text-gray-400 font-normal">/m√™s</span></div>
                        <ul class="text-left space-y-2 mb-6 text-gray-600 text-xs">
                            <li class="flex items-center"><i class="fa-solid fa-check text-green-500 mr-2"></i> Custo Intermedi√°rio</li>
                            <li class="flex items-center"><i class="fa-solid fa-check text-green-500 mr-2"></i> Todos os Hor√°rios</li>
                            <li class="flex items-center"><i class="fa-solid fa-check text-green-500 mr-2"></i> Fidelidade 3 Meses</li>
                        </ul>
                        <p class="text-xs text-gray-400 mt-4 pt-4 border-t border-gray-100 font-medium">Idade: 12 anos ou mais</p>
                    </div>
                    <div class="p-6 pt-0"><button onclick="selectPlan('adulto-trimestral', '147,90')" class="w-full py-2 border-2 border-brand-dark text-brand-dark font-bold rounded hover:bg-brand-dark hover:text-white transition">Selecionar</button></div>
                </div>
                <!-- Plan 6: Jovem/Adulto Semestral -->
                <div class="bg-white rounded-2xl shadow-xl overflow-hidden border-t-4 border-brand-red transform md:-translate-y-2 relative flex flex-col">
                    <div class="absolute top-0 right-0 bg-brand-red text-white text-[10px] font-bold px-2 py-1 rounded-bl z-10">MAIS VANTAJOSO</div>
                    <div class="p-6 text-center flex-grow">
                        <h3 class="font-display text-xl font-bold text-brand-red mb-1">JOVEM/ADULTO</h3>
                        <p class="text-gray-500 text-xs font-bold uppercase mb-4 tracking-wide">Plano Semestral</p>
                        <div class="text-3xl font-bold text-brand-dark mb-2">R$ 29,90<span class="text-sm text-gray-400 font-normal"> (1¬∫ m√™s)</span></div>
                        <div class="mb-4 bg-green-50 py-2 px-1 rounded border border-green-200">
                            <p class="text-xs text-green-700 font-bold">A partir do 2¬∫ m√™s: R$ 126,90/m√™s</p>
                        </div>
                        <ul class="text-left space-y-2 mb-6 text-gray-600 text-xs">
                            <li class="flex items-center"><i class="fa-solid fa-check text-green-500 mr-2"></i> Melhor Custo-Benef√≠cio</li>
                            <li class="flex items-center"><i class="fa-solid fa-check text-green-500 mr-2"></i> Fidelidade 6 Meses</li>
                            <li class="flex items-center"><i class="fa-solid fa-check text-green-500 mr-2"></i> Camiseta Gr√°tis</li>
                        </ul>
                        <p class="text-xs text-gray-400 mt-4 pt-4 border-t border-gray-100 font-medium">Idade: 12 anos ou mais</p>
                    </div>
                    <div class="p-6 pt-0"><button onclick="selectPlan('adulto-semestral', '126,90')" class="w-full py-2 bg-brand-red text-white font-bold rounded hover:bg-red-700 transition shadow-lg">Selecionar</button></div>
                </div>
            </div>

            <!-- T√≠tulo Planos Fam√≠lia -->
            <div class="text-center mb-10 mt-16">
                <h2 class="font-display text-3xl font-bold text-brand-dark mb-2 border-t-2 border-gray-200 pt-8 inline-block">COMBOS: PLANO FAM√çLIA</h2>
                <p class="text-gray-600 max-w-2xl mx-auto text-sm">Treinar em fam√≠lia √© muito melhor! Aproveite nossos combos semestrais com descontos exclusivos. Um √∫nico pagamento para a fam√≠lia inteira.</p>
            </div>

            <!-- Planos Fam√≠lia -->
            <div class="grid md:grid-cols-2 gap-6 max-w-4xl mx-auto">
                <!-- Combo Dupla -->
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden border-t-4 border-purple-500 hover:shadow-xl transition duration-300 flex flex-col">
                    <div class="p-6 text-center flex-grow">
                        <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4 text-purple-600 text-xl"><i class="fa-solid fa-people-arrows"></i></div>
                        <h3 class="font-display text-xl font-bold text-purple-700 mb-1">COMBO DUPLA</h3>
                        <p class="text-gray-500 text-xs font-bold uppercase mb-4 tracking-wide">Semestral (1 Adulto + 1 Crian√ßa)</p>
                        <div class="text-3xl font-bold text-brand-dark mb-2">R$ 59,90<span class="text-sm text-gray-400 font-normal"> (1¬∫ m√™s)</span></div>
                        <div class="mb-4 bg-green-50 py-2 px-1 rounded border border-green-200">
                            <p class="text-xs text-green-700 font-bold">A partir do 2¬∫ m√™s: R$ 250,00/m√™s</p>
                        </div>
                        <ul class="text-left space-y-2 mb-6 text-gray-600 text-xs">
                            <li class="flex items-center"><i class="fa-solid fa-check text-purple-500 mr-2"></i> V√°lido para Pai/M√£e + Filho(a)</li>
                            <li class="flex items-center"><i class="fa-solid fa-check text-purple-500 mr-2"></i> Pagamento √önico do Titular</li>
                            <li class="flex items-center"><i class="fa-solid fa-check text-purple-500 mr-2"></i> Fidelidade 6 Meses</li>
                        </ul>
                    </div>
                    <div class="p-6 pt-0"><button onclick="selectPlan('combo-dupla', '250,00', 'COMBO DUPLA (1 ADULTO + 1 INFANTIL) SEMESTRAL')" class="w-full py-2 bg-purple-600 text-white font-bold rounded hover:bg-purple-700 transition shadow-md">Selecionar Combo</button></div>
                </div>

                <!-- Combo Fam√≠lia -->
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden border-t-4 border-indigo-500 hover:shadow-xl transition duration-300 flex flex-col">
                    <div class="p-6 text-center flex-grow">
                        <div class="w-12 h-12 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4 text-indigo-600 text-xl"><i class="fa-solid fa-people-roof"></i></div>
                        <h3 class="font-display text-xl font-bold text-indigo-700 mb-1">COMBO FAM√çLIA</h3>
                        <p class="text-gray-500 text-xs font-bold uppercase mb-4 tracking-wide">Semestral (2 Adultos + 1 Crian√ßa)</p>
                        <div class="text-3xl font-bold text-brand-dark mb-2">R$ 89,90<span class="text-sm text-gray-400 font-normal"> (1¬∫ m√™s)</span></div>
                        <div class="mb-4 bg-green-50 py-2 px-1 rounded border border-green-200">
                            <p class="text-xs text-green-700 font-bold">A partir do 2¬∫ m√™s: R$ 362,02/m√™s</p>
                        </div>
                        <ul class="text-left space-y-2 mb-6 text-gray-600 text-xs">
                            <li class="flex items-center"><i class="fa-solid fa-check text-indigo-500 mr-2"></i> Para 2 Adultos e 1 Crian√ßa</li>
                            <li class="flex items-center"><i class="fa-solid fa-check text-indigo-500 mr-2"></i> Total contrato R$ 1.900,00</li>
                            <li class="flex items-center"><i class="fa-solid fa-check text-indigo-500 mr-2"></i> Fidelidade 6 Meses</li>
                        </ul>
                    </div>
                    <div class="p-6 pt-0"><button onclick="selectPlan('combo-familia', '362,02', 'COMBO FAM√çLIA (2 ADULTOS + 1 INFANTIL) SEMESTRAL')" class="w-full py-2 border-2 border-indigo-600 text-indigo-700 font-bold rounded hover:bg-indigo-600 hover:text-white transition">Selecionar Combo</button></div>
                </div>
            </div>
            
        </div>
    </section>

    <!-- Registration Section -->
    <section id="register" class="py-20 bg-brand-dark text-white relative">
        <div class="container mx-auto px-6">
            <div class="flex flex-col md:flex-row gap-12">
                <div class="md:w-1/3">
                    <h2 class="font-display text-4xl font-bold mb-6">PR√â-MATR√çCULA <span class="text-brand-red">ONLINE</span></h2>
                    <p class="text-gray-400 mb-4">Preencha seus dados para gerar seu contrato digital. Ao finalizar, sua matr√≠cula estar√° pr√©-aprovada.</p>
                    <p class="text-brand-red text-sm font-bold bg-gray-800 p-3 rounded mb-8 border border-gray-700 shadow-sm">
                        <i class="fa-solid fa-circle-exclamation mr-1"></i> Aten√ß√£o: O pagamento da mensalidade ou combos dever√° ser efetuado presencialmente na unidade ou via WhatsApp para concluir a sua matr√≠cula.
                    </p>
                    
                    <div id="plan-summary" class="mb-8 p-6 bg-gray-800 rounded-lg border border-gray-700 hidden">
                        <h4 class="text-gray-400 text-xs uppercase tracking-widest mb-2">Plano Selecionado</h4>
                        <div class="flex justify-between items-end">
                            <span id="summary-name" class="font-display text-2xl font-bold text-brand-red">---</span>
                            <span id="summary-price" class="text-xl">R$ 0,00</span>
                        </div>
                        <p id="promo-msg" class="text-green-400 text-xs mt-2 hidden"><i class="fa-solid fa-tag"></i> 1¬∫ M√™s por R$ 29,90 (Promo√ß√£o Semestral)</p>
                    </div>

                    <div class="space-y-6">
                        <a href="https://maps.app.goo.gl/Qr4yLUTsVaZPiery9" target="_blank" class="flex items-center group hover:bg-gray-800 p-3 -ml-3 rounded-lg transition duration-300 cursor-pointer">
                            <div class="w-12 h-12 bg-gray-800 rounded-full flex items-center justify-center text-brand-red mr-4 group-hover:bg-brand-red group-hover:text-white transition duration-300"><i class="fa-solid fa-location-dot"></i></div>
                            <div><h4 class="font-bold group-hover:text-brand-red transition duration-300">Localiza√ß√£o <i class="fa-solid fa-arrow-up-right-from-square text-xs ml-1 opacity-50"></i></h4><p class="text-gray-400 text-sm group-hover:text-gray-200 transition duration-300">Rua Jos√© Custodio de Almeida, N¬∫ 9 <br>Parque Verde - <strong class="text-white">Bel√©m, Par√° (PA)</strong></p></div>
                        </a>
                        <a href="https://wa.me/5591998192610" target="_blank" class="flex items-center group hover:bg-gray-800 p-3 -ml-3 rounded-lg transition duration-300 cursor-pointer">
                            <div class="w-12 h-12 bg-gray-800 rounded-full flex items-center justify-center text-brand-red mr-4 group-hover:bg-brand-red group-hover:text-white transition duration-300"><i class="fa-brands fa-whatsapp"></i></div>
                            <div><h4 class="font-bold group-hover:text-brand-red transition duration-300">WhatsApp <i class="fa-solid fa-arrow-up-right-from-square text-xs ml-1 opacity-50"></i></h4><p class="text-gray-400 text-sm group-hover:text-gray-200 transition duration-300">(91) 99819-2610</p></div>
                        </a>
                    </div>
                    
                    <!-- Mapa embutido (Google Maps) -->
                    <div class="mt-8 bg-gray-800 p-4 rounded-lg border border-gray-700 shadow-inner hidden md:block">
                        <h4 class="text-white font-bold uppercase tracking-wider mb-3 text-sm flex items-center"><i class="fa-solid fa-map-location-dot text-brand-red mr-2 text-lg"></i> Nossa Unidade em <span class="text-brand-red ml-1">Bel√©m-PA</span></h4>
                        <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3988.6214531818274!2d-48.4533036!3d-1.373678!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x92a48ac11a76dc11%3A0x86bd615f1f7e0fc2!2sR.%20Jos%C3%A9%20Cust%C3%B3dio%20de%20Almeida%2C%209%20-%20Parque%20Verde%2C%20Bel%C3%A9m%20-%20PA%2C%2066635-110!5e0!3m2!1spt-BR!2sbr!4v1708260000000!5m2!1spt-BR!2sbr" width="100%" height="200" style="border:0; border-radius: 0.5rem;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                    </div>
                </div>

                <div class="md:w-2/3 bg-white text-gray-800 rounded-xl shadow-2xl p-6 md:p-8">
                    <form id="registrationForm" onsubmit="openReviewModal(event)">
                        <h3 id="step1-title" class="font-display text-xl font-bold mb-4 border-b pb-2">1. Dados do Aluno</h3>
                        <p class="text-xs text-gray-500 mb-4 bg-blue-50 p-2 rounded border border-blue-100 hidden" id="combo-alert">
                            <i class="fa-solid fa-circle-info text-blue-500 mr-1"></i> Voc√™ selecionou um Plano Fam√≠lia. Preencha aqui os dados do <strong>TITULAR</strong> (respons√°vel financeiro).
                        </p>
                        <div class="grid md:grid-cols-2 gap-4 mb-4">
                            <div><label class="block text-sm font-bold mb-1 text-gray-600">Nome do Aluno</label><input type="text" id="studentName" required class="w-full bg-gray-100 border border-gray-300 rounded p-3 focus:outline-none focus:border-brand-red" placeholder="Nome completo do aluno"></div>
                            <div>
                                <label class="block text-sm font-bold mb-1 text-gray-600">Data de Nascimento</label>
                                <input type="date" id="studentDob" required onchange="validateAge()" class="w-full bg-gray-100 border border-gray-300 rounded p-3 focus:outline-none focus:border-brand-red text-gray-600">
                                <p id="age-validation-msg" class="text-red-600 text-xs mt-1 font-bold hidden"></p>
                            </div>
                        </div>
                        <div class="md:col-span-2 mb-4">
                            <label class="inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="hasGraduationCheck" onclick="toggleGraduationFields()" class="form-checkbox h-5 w-5 text-brand-red rounded border-gray-300 focus:ring-brand-red">
                                <span class="ml-2 text-gray-700 font-bold text-sm">J√° possui gradua√ß√£o (faixa)?</span>
                            </label>
                        </div>
                        <div id="graduationContainer" class="hidden grid md:grid-cols-2 gap-4 mb-6 p-4 bg-gray-50 border border-gray-200 rounded">
                            <div>
                                <label class="block text-sm font-bold mb-1 text-gray-600">Cor da Faixa</label>
                                <select id="beltColor" class="w-full bg-white border border-gray-300 rounded p-3 focus:outline-none focus:border-brand-red">
                                    <option value="" disabled selected>Selecione a cor</option>
                                    <option value="Branca">Branca</option>
                                    <option value="Cinza">Cinza</option>
                                    <option value="Amarela">Amarela</option>
                                    <option value="Laranja">Laranja</option>
                                    <option value="Verde">Verde</option>
                                    <option value="Azul">Azul</option>
                                    <option value="Roxa">Roxa</option>
                                    <option value="Marrom">Marrom</option>
                                    <option value="Preta">Preta</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-bold mb-1 text-gray-600">Grau(s)</label>
                                <select id="beltDegree" class="w-full bg-white border border-gray-300 rounded p-3 focus:outline-none focus:border-brand-red">
                                    <option value="0">0</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                </select>
                            </div>
                        </div>
                        
                        <div id="guardianContainer" class="hidden mb-4 p-4 bg-gray-50 border border-gray-200 rounded">
                            <h4 class="text-sm font-bold text-brand-red mb-3 border-b border-gray-200 pb-1 uppercase">Respons√°vel Legal (Obrigat√≥rio para menores ou Planos Infantis)</h4>
                            <div class="grid md:grid-cols-2 gap-4 mb-2">
                                <div>
                                    <label class="block text-sm font-bold mb-1 text-gray-600">Nome do Respons√°vel</label>
                                    <input type="text" id="guardianName" class="w-full bg-white border border-gray-300 rounded p-3 focus:outline-none focus:border-brand-red" placeholder="Nome completo do respons√°vel">
                                </div>
                                <div>
                                    <label class="block text-sm font-bold mb-1 text-gray-600">Parentesco</label>
                                    <select id="guardianKinship" class="w-full bg-white border border-gray-300 rounded p-3 focus:outline-none focus:border-brand-red">
                                        <option value="" disabled selected>Selecione...</option>
                                        <option value="Pai">Pai</option>
                                        <option value="M√£e">M√£e</option>
                                        <option value="Av√¥/Av√≥">Av√¥/Av√≥</option>
                                        <option value="Tio/Tia">Tio/Tia</option>
                                        <option value="Outro">Outro</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- DEPENDENTS SECTION (For Combos) -->
                        <div id="dependentsSection" class="hidden mb-4 border-t-2 border-purple-200 pt-6">
                            <h3 class="font-display text-xl font-bold mb-2 text-purple-700 flex items-center gap-2"><i class="fa-solid fa-users"></i> Dados dos Dependentes</h3>
                            <p class="text-xs text-gray-500 mb-4">Preencha os dados dos familiares que far√£o parte deste Combo.</p>

                            <!-- Dependent 1 -->
                            <div id="dep1Container" class="hidden bg-purple-50 border border-purple-200 rounded p-4 mb-4 shadow-sm">
                                <h4 class="font-bold text-sm text-purple-800 mb-3 border-b border-purple-200 pb-1">Dependente 1 (Obrigat√≥rio)</h4>
                                <div class="grid md:grid-cols-2 gap-4 mb-3">
                                    <div class="md:col-span-2"><label class="block text-xs font-bold mb-1 text-gray-600">Nome Completo</label><input type="text" id="dep1Name" class="w-full bg-white border border-gray-300 rounded p-2 focus:border-purple-500"></div>
                                    <div><label class="block text-xs font-bold mb-1 text-gray-600">Data de Nascimento</label><input type="date" id="dep1Dob" class="w-full bg-white border border-gray-300 rounded p-2"></div>
                                    <div><label class="block text-xs font-bold mb-1 text-gray-600">Parentesco com o Titular</label>
                                         <select id="dep1Kinship" class="w-full bg-white border border-gray-300 rounded p-2">
                                             <option value="" disabled selected>Selecione...</option>
                                             <option value="Filho(a)">Filho(a)</option>
                                             <option value="C√¥njuge">C√¥njuge</option>
                                             <option value="Irm√£o/Irm√£">Irm√£o/Irm√£</option>
                                             <option value="Outro">Outro</option>
                                         </select>
                                    </div>
                                </div>
                                <label class="inline-flex items-center cursor-pointer mb-2"><input type="checkbox" id="dep1HasBelt" onclick="toggleDepBelt(1)" class="form-checkbox text-purple-600 rounded border-gray-300"><span class="ml-2 text-gray-700 font-bold text-xs">Este dependente j√° possui gradua√ß√£o (faixa)?</span></label>
                                <div id="dep1BeltContainer" class="hidden grid md:grid-cols-2 gap-4 bg-white p-3 border border-purple-100 rounded">
                                    <div><label class="block text-xs font-bold mb-1">Cor</label><select id="dep1Color" class="w-full border rounded p-2 text-sm"><option value="Branca">Branca</option><option value="Cinza">Cinza</option><option value="Amarela">Amarela</option><option value="Laranja">Laranja</option><option value="Verde">Verde</option><option value="Azul">Azul</option><option value="Roxa">Roxa</option><option value="Marrom">Marrom</option><option value="Preta">Preta</option></select></div>
                                    <div><label class="block text-xs font-bold mb-1">Grau</label><select id="dep1Degree" class="w-full border rounded p-2 text-sm"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option></select></div>
                                </div>
                            </div>

                            <!-- Dependent 2 -->
                            <div id="dep2Container" class="hidden bg-purple-50 border border-purple-200 rounded p-4 mb-4 shadow-sm">
                                <h4 class="font-bold text-sm text-purple-800 mb-3 border-b border-purple-200 pb-1">Dependente 2 (Obrigat√≥rio)</h4>
                                <div class="grid md:grid-cols-2 gap-4 mb-3">
                                    <div class="md:col-span-2"><label class="block text-xs font-bold mb-1 text-gray-600">Nome Completo</label><input type="text" id="dep2Name" class="w-full bg-white border border-gray-300 rounded p-2 focus:border-purple-500"></div>
                                    <div><label class="block text-xs font-bold mb-1 text-gray-600">Data de Nascimento</label><input type="date" id="dep2Dob" class="w-full bg-white border border-gray-300 rounded p-2"></div>
                                    <div><label class="block text-xs font-bold mb-1 text-gray-600">Parentesco com o Titular</label>
                                         <select id="dep2Kinship" class="w-full bg-white border border-gray-300 rounded p-2">
                                             <option value="" disabled selected>Selecione...</option>
                                             <option value="Filho(a)">Filho(a)</option>
                                             <option value="C√¥njuge">C√¥njuge</option>
                                             <option value="Irm√£o/Irm√£">Irm√£o/Irm√£</option>
                                             <option value="Outro">Outro</option>
                                         </select>
                                    </div>
                                </div>
                                <label class="inline-flex items-center cursor-pointer mb-2"><input type="checkbox" id="dep2HasBelt" onclick="toggleDepBelt(2)" class="form-checkbox text-purple-600 rounded border-gray-300"><span class="ml-2 text-gray-700 font-bold text-xs">Este dependente j√° possui gradua√ß√£o (faixa)?</span></label>
                                <div id="dep2BeltContainer" class="hidden grid md:grid-cols-2 gap-4 bg-white p-3 border border-purple-100 rounded">
                                    <div><label class="block text-xs font-bold mb-1">Cor</label><select id="dep2Color" class="w-full border rounded p-2 text-sm"><option value="Branca">Branca</option><option value="Cinza">Cinza</option><option value="Amarela">Amarela</option><option value="Laranja">Laranja</option><option value="Verde">Verde</option><option value="Azul">Azul</option><option value="Roxa">Roxa</option><option value="Marrom">Marrom</option><option value="Preta">Preta</option></select></div>
                                    <div><label class="block text-xs font-bold mb-1">Grau</label><select id="dep2Degree" class="w-full border rounded p-2 text-sm"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option></select></div>
                                </div>
                            </div>
                        </div>

                        <h3 class="font-display text-xl font-bold mb-4 border-b pb-2 mt-6">2. Dados Financeiros/Contato</h3>
                        <div class="grid md:grid-cols-2 gap-4 mb-4">
                            <div><label id="lblCpf" class="block text-sm font-bold mb-1 text-gray-600">CPF</label><input type="text" id="cpfInput" required maxlength="14" class="w-full bg-gray-100 border border-gray-300 rounded p-3 focus:outline-none focus:border-brand-red" placeholder="000.000.000-00"></div>
                            <div><label id="lblPhone" class="block text-sm font-bold mb-1 text-gray-600">Telefone</label><input type="tel" id="phoneInput" required maxlength="15" class="w-full bg-gray-100 border border-gray-300 rounded p-3 focus:outline-none focus:border-brand-red" placeholder="(91) 90000-0000"></div>
                            <div class="md:col-span-2"><label id="lblEmail" class="block text-sm font-bold mb-1 text-gray-600">E-mail</label><input type="email" id="emailInput" required class="w-full bg-gray-100 border border-gray-300 rounded p-3 focus:outline-none focus:border-brand-red" placeholder="seu@email.com" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$" title="Formato inv√°lido. Ex: nome@email.com"></div>
                        </div>
                        <div class="mb-6"><label class="block text-sm font-bold mb-1 text-gray-600">Endere√ßo Completo</label><input type="text" id="addressInput" required class="w-full bg-gray-100 border border-gray-300 rounded p-3 focus:outline-none focus:border-brand-red" placeholder="Rua, N√∫mero, Bairro, Cidade - Estado"></div>
                        
                        <!-- NEW PAYMENT METHOD SELECT -->
                        <div class="mb-6">
                            <label class="block text-sm font-bold mb-1 text-gray-600">Forma de Pagamento</label>
                            <select id="paymentMethod" required class="w-full bg-gray-100 border border-gray-300 rounded p-3 focus:outline-none focus:border-brand-red text-gray-700">
                                <option value="" disabled selected>Selecione a forma de pagamento...</option>
                                <optgroup label="Cr√©dito">
                                    <option value="Cr√©dito √† vista">Cr√©dito √† vista</option>
                                    <option value="Cr√©dito 2x">Cr√©dito 2x</option>
                                    <option value="Cr√©dito 3x">Cr√©dito 3x</option>
                                </optgroup>
                                <optgroup label="√Ä vista">
                                    <option value="Dinheiro">Dinheiro</option>
                                    <option value="Pix">Pix</option>
                                    <option value="D√©bito">D√©bito</option>
                                </optgroup>
                            </select>
                        </div>

                        <input type="hidden" id="selectedPlanInput" name="plan" required>
                        <input type="hidden" id="selectedPlanCustomName" name="planNameCustom" required>
                        
                        <!-- Step 3: Contract -->
                        <h3 class="font-display text-xl font-bold mb-4 border-b pb-2 mt-8">3. Contrato de Presta√ß√£o de Servi√ßos</h3>
                        
                        <div class="bg-gray-50 border border-gray-300 rounded p-4 h-64 overflow-y-scroll mb-4 text-sm text-gray-600 contract-scroll text-justify">
                            <p class="font-bold mb-2 text-center">CONTRATO DE ADES√ÉO E PRESTA√á√ÉO DE SERVI√áOS DE ENSINO ESPORTIVO</p>
                            
                            <p class="mb-2"><strong>CL√ÅUSULA 1¬™ ‚Äì DO OBJETO</strong><br>1.1. O presente contrato tem por objeto a presta√ß√£o de servi√ßos de ensino e treinamento de JIU-JITSU pela CONTRATADA ao CONTRATANTE, nas depend√™ncias da TANQUE TEAM BJJ.<br>1.2. As aulas ser√£o ministradas nos dias e hor√°rios estipulados na grade hor√°ria vigente, a qual poder√° sofrer altera√ß√µes mediante aviso pr√©vio da ACADEMIA.</p>
                            
                            <p class="mb-2"><strong>CL√ÅUSULA 2¬™ ‚Äì DO PLANO E PAGAMENTO</strong><br>2.1. O CONTRATANTE opta pelo plano selecionado na matr√≠cula.<br>2.2. O valor e forma de pagamento s√£o os definidos no ato da matr√≠cula.<br>2.3. As mensalidades dever√£o ser pagas at√© o dia 10 de cada m√™s.<br>2.4. Atrasos: O atraso no pagamento implicar√° em multa de 2% (dois por cento) e juros de mora de 1% (um por cento) ao m√™s. Ap√≥s 15 dias de atraso, o acesso √†s aulas poder√° ser bloqueado at√© a regulariza√ß√£o.<br>2.5. <strong>Planos Fam√≠lia (Combos):</strong> O pagamento dever√° ser realizado de forma √∫nica e integral pelo CONTRATANTE titular. O cancelamento ou afastamento de um dos benefici√°rios dependentes n√£o d√° direito a reembolso parcial e reverte automaticamente o plano remanescente para o valor da tabela individual vigente.</p>
                            
                            <p class="mb-2"><strong>CL√ÅUSULA 3¬™ ‚Äì DA SA√öDE E APTID√ÉO F√çSICA</strong><br>3.1. O CONTRATANTE declara, neste ato, estar em plenas condi√ß√µes f√≠sicas e mentais para a pr√°tica de atividades f√≠sicas, isentando a ACADEMIA de qualquer responsabilidade sobre problemas de sa√∫de pr√©-existentes n√£o informados.<br>3.2. O CONTRATANTE compromete-se a apresentar atestado m√©dico de aptid√£o f√≠sica no prazo m√°ximo de 15 (quinze) dias a contar da assinatura deste contrato, caso exigido pela legisla√ß√£o local.</p>
                            
                            <p class="mb-2"><strong>CL√ÅUSULA 4¬™ ‚Äì DO RISCO INERENTE √Ä PR√ÅTICA</strong><br>4.1. O CONTRATANTE declara estar ciente de que o Jiu-Jitsu √© um esporte de contato f√≠sico e combate, havendo risco inerente de contus√µes, les√µes ou acidentes durante os treinos, eximindo a ACADEMIA e seus instrutores de responsabilidade civil por acidentes decorrentes da pr√°tica normal e leal do esporte.</p>
                            
                            <p class="mb-2"><strong>CL√ÅUSULA 5¬™ ‚Äì DAS NORMAS DE CONDUTA E HIGIENE (DOJO KUN)</strong><br>5.1. √â obrigat√≥rio o uso de uniforme (Kimono/Gi ou No-Gi) adequado, limpo e em bom estado de conserva√ß√£o, respeitando as cores e padroniza√ß√µes da TANQUE TEAM BJJ.<br>5.2. O aluno deve manter a higiene pessoal em dia (unhas cortadas, cabelos limpos e presos, aus√™ncia de odores fortes), visando a seguran√ßa e o respeito aos colegas de treino.<br>5.3. A ACADEMIA reserva-se o direito de impedir o treino do aluno que n√£o estiver com a vestimenta adequada ou condi√ß√µes de higiene satisfat√≥rias.<br>5.4. Atos de indisciplina, desrespeito ao Mestre/Professor ou aos colegas, agress√µes fora das regras do esporte ou conduta imoral dentro das depend√™ncias acarretar√£o no cancelamento imediato deste contrato, sem devolu√ß√£o de valores pagos.</p>
                            
                            <p class="mb-2"><strong>CL√ÅUSULA 6¬™ ‚Äì DO DIREITO DE IMAGEM</strong><br>6.1. O CONTRATANTE autoriza, a t√≠tulo gratuito e por prazo indeterminado, o uso de sua imagem (fotos e v√≠deos) captada durante os treinos, gradua√ß√µes e campeonatos, para fins de divulga√ß√£o, publicidade e marketing da TANQUE TEAM BJJ em redes sociais, sites e materiais impressos.</p>
                            
                            <p class="mb-2"><strong>CL√ÅUSULA 7¬™ ‚Äì DO CANCELAMENTO E TRANCAMENTO</strong><br>7.1. Planos Mensais: O cancelamento deve ser solicitado com 30 (trinta) dias de anteced√™ncia.<br>7.2. Planos Fidelidade (Trimestral/Semestral/Combos): Em caso de cancelamento antecipado por iniciativa do aluno, ser√° cobrada uma multa correspondente a 20% (vinte por cento) sobre o valor restante do contrato.<br>7.3. N√£o haver√° reembolso de valores pagos caso o aluno deixe de frequentar as aulas por motivos pessoais sem formalizar o cancelamento junto √† secretaria.</p>
                            
                            <p class="mb-2"><strong>CL√ÅUSULA 8¬™ ‚Äì DISPOSI√á√ïES GERAIS</strong><br>8.1. A ACADEMIA n√£o se responsabiliza pela guarda de objetos pessoais, valores ou equipamentos deixados nas depend√™ncias do estabelecimento.<br>8.2. Este contrato tem validade a partir da data de sua assinatura.</p>
                            
                            <p class="mt-4 text-center italic">"O Jiu-Jitsu √© a arte de ser suave com quem √© suave, e duro com quem √© duro."</p>
                        </div>
                        
                        <!-- Step 4: Signature -->
                        <div class="bg-gray-100 p-4 rounded-lg border border-gray-200">
                            <div class="flex items-center"><input type="checkbox" id="termsCheck" required class="w-5 h-5 text-brand-red focus:ring-brand-red border-gray-300 rounded mr-2 cursor-pointer"><label for="termsCheck" class="text-sm font-semibold cursor-pointer select-none">Li e concordo com todos os termos do contrato acima e declaro que as informa√ß√µes s√£o verdadeiras.</label></div>
                        </div>
                        <button type="submit" id="submitBtn" class="w-full mt-6 bg-brand-red text-white font-bold py-4 rounded text-lg uppercase tracking-wider hover:bg-red-700 transition shadow-lg flex justify-center items-center gap-2"><span>Confirmar Matr√≠cula</span><i class="fa-solid fa-file-pen"></i></button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-black text-white py-10 border-t border-gray-900">
        <div class="container mx-auto px-6 text-center">
            <h2 class="font-display text-2xl font-bold mb-4">TANQUE TEAM <span class="text-brand-red">BJJ</span></h2>
            <div class="flex justify-center space-x-6 mb-8">
                <a href="#" class="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center hover:bg-brand-red transition"><i class="fa-brands fa-instagram"></i></a>
                <a href="#" class="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center hover:bg-brand-red transition"><i class="fa-brands fa-facebook-f"></i></a>
                <a href="#" class="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center hover:bg-brand-red transition"><i class="fa-brands fa-youtube"></i></a>
            </div>
            <div class="flex justify-center gap-4 text-xs text-gray-500 mb-4">
                <a href="https://tanqueteambjj.github.io/inicio/login_aluno.html" class="hover:text-gray-300">√Årea do Aluno</a>
                <span class="text-gray-700">|</span>
                <a href="https://tanqueteambjj.github.io/inicio/login_aluno.html" class="hover:text-gray-300">√Årea Administrativa</a>
            </div>
            <p class="text-gray-600 text-sm mb-4">&copy; 2026 Tanque Team BJJ Academy. Todos os direitos reservados. Oss.</p>
        </div>
    </footer>

    <!-- Modals -->
    <!-- Confirmation Modal -->
    <div id="confirmationModal" class="fixed inset-0 z-[70] hidden overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-900 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 sm:mx-0 sm:h-10 sm:w-10"><i class="fa-solid fa-circle-info text-blue-600"></i></div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                            <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">Confirme seus dados</h3>
                            <div class="mt-2"><p class="text-sm text-gray-500 mb-4">Por favor, revise as informa√ß√µes antes de finalizar a matr√≠cula.</p><div id="reviewContent" class="text-sm text-gray-700 space-y-2 bg-gray-50 p-3 rounded border border-gray-200 text-left"></div></div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse gap-2">
                    <button type="button" onclick="finalizeRegistration()" id="finalConfirmBtn" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-brand-red text-base font-medium text-white hover:bg-red-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm">Tudo Certo, Matricular</button>
                    <button type="button" onclick="closeConfirmation()" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">Corrigir Dados</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="fixed inset-0 z-[80] hidden overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-900 bg-opacity-75 transition-opacity" aria-hidden="true" onclick="closeModal()"></div>
            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-green-100 sm:mx-0 sm:h-10 sm:w-10"><i class="fa-solid fa-check text-green-600"></i></div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                            <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">Pr√©-Matr√≠cula aprovada!</h3>
                            <div class="mt-2">
                                <p class="text-sm text-gray-500">Bem-vindo √† fam√≠lia Tanque Team, <span id="modalClientName" class="font-bold"></span>!</p>
                                <p class="text-sm text-gray-500 mt-2">Sua matr√≠cula no plano <span id="modalPlanName" class="font-bold"></span> foi recebida.</p>
                                <p id="email-status-msg" class="text-sm text-green-600 mt-2 font-semibold"><i class="fa-solid fa-envelope-circle-check"></i> Voc√™ receber√° as informa√ß√µes e o contrato por e-mail.</p>
                                <div class="mt-4 bg-gray-50 p-3 rounded border border-dashed border-gray-300">
                                    <p class="text-xs text-gray-400 uppercase">Pr√≥ximo Passo:</p>
                                    <p class="text-sm font-semibold text-red-600 mb-2 uppercase">REALIZAR O PAGAMENTO NA UNIDADE OU VIA WHATSAPP NO BOT√ÉO ABAIXO</p>
                                    <a href="https://wa.me/5591998192610" target="_blank" class="block w-full text-center bg-green-100 hover:bg-green-200 text-green-800 text-sm font-bold py-2 rounded transition duration-300 border border-green-300"><i class="fa-brands fa-whatsapp mr-1"></i> Mais Informa√ß√µes / Pagamento</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" onclick="closeModal()" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-brand-red text-base font-medium text-white hover:bg-red-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm">Entendido, Oss!</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Printable Contract (Hidden in Web, Visible in Print) -->
    <div id="printable-contract" class="hidden bg-white text-black p-12 font-serif text-sm leading-relaxed">
        <div class="header-section text-center mb-6 border-b-2 border-black pb-4">
            <h1 class="text-2xl font-bold uppercase tracking-wider mb-1">Tanque Team BJJ</h1>
            <p class="text-xs">CNPJ: 00.000.000/0001-00</p>
            <p class="text-xs">Rua Jos√© Custodio de Almeida, N¬∫ 9 - Parque Verde - Bel√©m-PA, CEP 66635-110</p>
            <p class="text-xs">Tel: (91) 99819-2610 | Email: contato@tanqueteambjj.com</p>
        </div>
        <h2 class="text-center font-bold text-lg mb-6 uppercase underline tracking-wide">Contrato de Presta√ß√£o de Servi√ßos Esportivos</h2>
        
        <div class="parties-section mb-6 text-sm text-justify space-y-2 bg-gray-50 p-4 border border-gray-200 rounded">
            <p><strong>1. CONTRATADA:</strong> <span class="uppercase font-bold">Tanque Team Academia de Artes Marciais LTDA</span>, inscrita no CNPJ sob o n¬∫ 00.000.000/0001-00.</p>
            <p><strong>2. CONTRATANTE (Respons√°vel Financeiro):</strong> <span id="printContratante" class="font-bold uppercase"></span>, inscrito(a) no CPF sob o n¬∫ <span id="printCPF" class="font-mono font-bold"></span>, residente e domiciliado(a) em <span id="printAddress" class="uppercase"></span>, Telefone: <span id="printPhone"></span>, E-mail: <span id="printEmail"></span>.</p>
            <p><strong>3. ALUNO(A) PRINCIPAL:</strong> <span id="printStudent" class="font-bold uppercase"></span>, nascido(a) em <span id="printDob" class="font-mono"></span>. <span id="printBeltInfo"></span></p>
            <div id="printDependentsBlock" class="mt-2 pl-4 border-l-2 border-gray-400"></div>
        </div>

        <div id="print-clauses-container" class="clauses-section text-sm text-justify mb-6 space-y-3">
            <!-- JS Injected Clauses -->
        </div>

        <div class="signatures-section mt-16 page-break-inside-avoid">
            <p class="mb-12 text-right text-sm">Bel√©m-PA, <span id="printContractDate"></span>.</p>
            <div class="flex justify-between gap-12 mt-16 px-8">
                <div class="w-1/2 text-center">
                    <div class="border-t border-black pt-2">
                        <p class="font-bold uppercase text-xs tracking-wider">Tanque Team BJJ (CONTRATADA)</p>
                    </div>
                </div>
                <div class="w-1/2 text-center">
                    <div class="border-t border-black pt-2">
                        <p class="font-bold text-sm uppercase" id="printSignatureName"></p>
                        <p class="font-bold uppercase text-[10px] text-gray-600 tracking-wider">CONTRATANTE / RESPONS√ÅVEL FINANCEIRO</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        const EMAILJS_SERVICE_ID = "service_yq744mr"; 
        const EMAILJS_TEMPLATE_ID = "template_few5bna"; 
        const EMAILJS_PUBLIC_KEY = "joP6USyQXdqGI3GN5";   
        
        (function(){ emailjs.init(EMAILJS_PUBLIC_KEY); })();

        document.getElementById('mobile-menu-btn').addEventListener('click', () => document.getElementById('mobile-menu').classList.toggle('hidden'));
        
        const cpfInput = document.getElementById('cpfInput');
        cpfInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 11) value = value.slice(0, 11);
            if (value.length > 9) value = value.replace(/^(\d{3})(\d{3})(\d{3})(\d{2}).*/, '$1.$2.$3-$4');
            else if (value.length > 6) value = value.replace(/^(\d{3})(\d{3})(\d{3}).*/, '$1.$2.$3');
            else if (value.length > 3) value = value.replace(/^(\d{3})(\d{3}).*/, '$1.$2');
            e.target.value = value;
        });

        const phoneInput = document.getElementById('phoneInput');
        phoneInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 11) value = value.slice(0, 11);
            if (value.length > 10) value = value.replace(/^(\d{2})(\d{5})(\d{4}).*/, '($1) $2-$3');
            else if (value.length > 6) value = value.replace(/^(\d{2})(\d{4})(\d{0,4}).*/, '($1) $2-$3');
            else if (value.length > 2) value = value.replace(/^(\d{2})(\d{0,5}).*/, '($1) $2');
            else value = value.replace(/^(\d*)/, '($1');
            e.target.value = value;
        });

        function toggleGraduationFields() {
            const checkBox = document.getElementById("hasGraduationCheck");
            const container = document.getElementById("graduationContainer");
            const beltColor = document.getElementById("beltColor");
            if (checkBox.checked) { container.classList.remove("hidden"); container.classList.add("grid"); beltColor.setAttribute("required", "required"); } 
            else { container.classList.add("hidden"); container.classList.remove("grid"); beltColor.removeAttribute("required"); beltColor.value = ""; document.getElementById("beltDegree").value = "0"; }
        }

        function toggleDepBelt(num) {
            const checkBox = document.getElementById(`dep${num}HasBelt`);
            const container = document.getElementById(`dep${num}BeltContainer`);
            if (checkBox.checked) { container.classList.remove("hidden"); container.classList.add("grid"); } 
            else { container.classList.add("hidden"); container.classList.remove("grid"); }
        }

        function validateAge() {
            const dobInput = document.getElementById('studentDob');
            const planInput = document.getElementById('selectedPlanInput');
            const msgElement = document.getElementById('age-validation-msg');

            if (!dobInput.value) return null;
            
            const [year, month, day] = dobInput.value.split('-').map(Number);
            const dob = new Date(year, month - 1, day);
            const today = new Date();
            let age = today.getFullYear() - dob.getFullYear();
            const m = today.getMonth() - dob.getMonth();
            if (m < 0 || (m === 0 && today.getDate() < dob.getDate())) {
                age--;
            }

            const guardianContainer = document.getElementById('guardianContainer');
            const guardianInput = document.getElementById('guardianName');
            const guardianKinship = document.getElementById('guardianKinship');
            
            let planIsInfantil = planInput.value && planInput.value.includes('infantil') && !planInput.value.includes('combo');
            let needsGuardian = age < 18 || planIsInfantil;

            if (needsGuardian) {
                guardianContainer.classList.remove('hidden');
                guardianInput.setAttribute('required', 'required');
                guardianKinship.setAttribute('required', 'required');
                document.getElementById('lblCpf').innerText = "CPF do Respons√°vel";
                document.getElementById('lblEmail').innerText = "E-mail do Respons√°vel";
                document.getElementById('lblPhone').innerText = "Telefone do Respons√°vel";
            } else {
                guardianContainer.classList.add('hidden');
                guardianInput.removeAttribute('required');
                guardianKinship.removeAttribute('required');
                guardianInput.value = "";
                guardianKinship.value = "";
                document.getElementById('lblCpf').innerText = "CPF";
                document.getElementById('lblEmail').innerText = "E-mail";
                document.getElementById('lblPhone').innerText = "Telefone";
            }

            if (planInput.value) {
                let plan = planInput.value;
                let hasConflict = false;
                let errorMsg = "";

                if (plan.includes('infantil') && !plan.includes('combo')) {
                    if (age < 4 || age > 11) {
                        hasConflict = true;
                        errorMsg = `‚ö†Ô∏è A idade (${age} anos) n√£o corresponde ao plano INFANTIL (4 a 11 anos).`;
                    }
                } else if (plan.includes('adulto') && !plan.includes('combo')) {
                    if (age < 12) {
                        hasConflict = true;
                        errorMsg = `‚ö†Ô∏è A idade (${age} anos) n√£o corresponde ao plano JOVEM/ADULTO (12+ anos).`;
                    }
                }

                if (hasConflict) {
                    msgElement.innerText = errorMsg;
                    msgElement.classList.remove('hidden');
                    dobInput.classList.add('border-red-500', 'ring-2', 'ring-red-500');
                } else {
                    msgElement.classList.add('hidden');
                    dobInput.classList.remove('border-red-500', 'ring-2', 'ring-red-500');
                }
            }
            return age;
        }

        window.selectPlan = function(planName, price, customName = null) {
            const summaryName = document.getElementById('summary-name');
            const summaryPrice = document.getElementById('summary-price');
            const hiddenInput = document.getElementById('selectedPlanInput');
            const hiddenNameInput = document.getElementById('selectedPlanCustomName');
            const promoMsg = document.getElementById('promo-msg');
            const comboAlert = document.getElementById('combo-alert');
            const step1Title = document.getElementById('step1-title'); 
            
            const depSection = document.getElementById('dependentsSection');
            const dep1Box = document.getElementById('dep1Container');
            const dep2Box = document.getElementById('dep2Container');
            
            document.getElementById('plan-summary').classList.remove('hidden');
            
            let displayName = customName ? customName : planName.replace('infantil-', 'Infantil ').replace('adulto-', 'Jovem/Adulto ').replace('mensal', 'Mensal').replace('trimestral', 'Trimestral').replace('semestral', 'Semestral').toUpperCase();
            
            summaryName.innerText = displayName;
            summaryPrice.innerText = `R$ ${price}`;
            hiddenInput.value = planName;
            hiddenNameInput.value = displayName;

            if(planName.includes('semestral') && !planName.includes('combo')) {
                promoMsg.innerHTML = '<i class="fa-solid fa-tag"></i> 1¬∫ M√™s por R$ 29,90 (Promo√ß√£o Semestral)';
                promoMsg.classList.remove('hidden'); 
            } else if (planName === 'combo-dupla') {
                promoMsg.innerHTML = '<i class="fa-solid fa-tag"></i> 1¬∫ M√™s por R$ 59,90 (Promo√ß√£o Combo)';
                promoMsg.classList.remove('hidden'); 
            } else if (planName === 'combo-familia') {
                promoMsg.innerHTML = '<i class="fa-solid fa-tag"></i> 1¬∫ M√™s por R$ 89,90 (Promo√ß√£o Combo)';
                promoMsg.classList.remove('hidden'); 
            } else {
                promoMsg.classList.add('hidden');
            }
            
            ['dep1Name', 'dep1Dob', 'dep1Kinship', 'dep2Name', 'dep2Dob', 'dep2Kinship'].forEach(id => {
                document.getElementById(id).removeAttribute('required');
            });

            if (planName === 'combo-dupla') {
                step1Title.innerText = "1. Dados do Aluno (Titular do Combo)";
                comboAlert.classList.remove('hidden');
                comboAlert.classList.add('block');
                depSection.classList.remove('hidden');
                dep1Box.classList.remove('hidden');
                dep2Box.classList.add('hidden');
                ['dep1Name', 'dep1Dob', 'dep1Kinship'].forEach(id => document.getElementById(id).setAttribute('required', 'true'));
            } else if (planName === 'combo-familia') {
                step1Title.innerText = "1. Dados do Aluno (Titular do Combo)";
                comboAlert.classList.remove('hidden');
                comboAlert.classList.add('block');
                depSection.classList.remove('hidden');
                dep1Box.classList.remove('hidden');
                dep2Box.classList.remove('hidden');
                ['dep1Name', 'dep1Dob', 'dep1Kinship', 'dep2Name', 'dep2Dob', 'dep2Kinship'].forEach(id => document.getElementById(id).setAttribute('required', 'true'));
            } else {
                step1Title.innerText = "1. Dados do Aluno";
                comboAlert.classList.add('hidden');
                comboAlert.classList.remove('block');
                depSection.classList.add('hidden');
                dep1Box.classList.add('hidden');
                dep2Box.classList.add('hidden');
            }
            
            validateAge(); 
            document.getElementById('register').scrollIntoView({ behavior: 'smooth' });
        }

        window.openReviewModal = function(e) {
            e.preventDefault();
            const plan = document.getElementById('selectedPlanInput').value;
            const displayName = document.getElementById('selectedPlanCustomName').value;
            if(!plan) { alert("Por favor, selecione um plano."); return; }

            const msgElement = document.getElementById('age-validation-msg');
            if (!msgElement.classList.contains('hidden')) {
                alert("Por favor, corrija o conflito entre a Idade do aluno e o Plano selecionado antes de continuar.");
                document.getElementById('studentDob').focus();
                return;
            }
            
            const age = validateAge();
            if (age === null) {
                 alert("Por favor, preencha a Data de Nascimento.");
                 return;
            }

            const studentName = document.getElementById('studentName').value;
            const studentDob = document.getElementById('studentDob').value;
            const guardianName = document.getElementById('guardianName').value;
            const guardianKinship = document.getElementById('guardianKinship').value;
            let planIsInfantil = plan && plan.includes('infantil') && !plan.includes('combo');
            const needsGuardian = age < 18 || planIsInfantil;
            
            const cpf = document.getElementById('cpfInput').value;
            const email = document.getElementById('emailInput').value;
            const phone = document.getElementById('phoneInput').value;
            const address = document.getElementById('addressInput').value;
            const hasGraduation = document.getElementById("hasGraduationCheck").checked;
            const beltColor = hasGraduation ? document.getElementById("beltColor").value : "Iniciante/Branca";
            const beltDegree = hasGraduation ? document.getElementById("beltDegree").value : "0";
            const graduationText = hasGraduation ? `Faixa ${beltColor} - ${beltDegree}¬∫ Grau` : "Iniciante/Faixa Branca";
            
            const paymentMethod = document.getElementById('paymentMethod').value;
            if(!paymentMethod) { alert("Por favor, selecione a Forma de Pagamento."); return; }

            let price = "R$ 0,00";
            if(plan === 'infantil-mensal') price = "R$ 189,90";
            else if(plan === 'infantil-trimestral') price = "R$ 168,90";
            else if(plan === 'infantil-semestral') price = "R$ 157,90";
            else if(plan === 'adulto-mensal') price = "R$ 168,90";
            else if(plan === 'adulto-trimestral') price = "R$ 147,90";
            else if(plan === 'adulto-semestral') price = "R$ 126,90";
            else if(plan === 'combo-dupla') price = "R$ 250,00";
            else if(plan === 'combo-familia') price = "R$ 362,02";

            let promoNote = "";
            if (plan.includes('semestral') && !plan.includes('combo')) {
                promoNote = " (1¬™ Mensalidade R$ 29,90)";
            } else if (plan === 'combo-dupla') {
                promoNote = " (1¬™ Mensalidade R$ 59,90)";
            } else if (plan === 'combo-familia') {
                promoNote = " (1¬™ Mensalidade R$ 89,90)";
            }

            let reviewHtml = `
                <p><strong>Aluno/Titular:</strong> ${studentName}</p>
                <p><strong>Nascimento:</strong> ${studentDob.split('-').reverse().join('/')}</p>
                <p><strong>Gradua√ß√£o:</strong> ${graduationText}</p>
                ${needsGuardian ? `<p><strong>Respons√°vel:</strong> ${guardianName} (${guardianKinship})</p>` : ''}
                <p><strong>CPF:</strong> ${cpf}</p>
                <p><strong>E-mail:</strong> ${email}</p>
                <p><strong>Telefone:</strong> ${phone}</p>
                <p><strong>Endere√ßo:</strong> ${address}</p>
                <hr class="my-2">
                <p><strong>Plano:</strong> ${displayName}</p>
                <p><strong>Valor:</strong> ${price} <span class="text-green-600 font-bold">${promoNote}</span></p>
                <p><strong>Pagamento:</strong> ${paymentMethod}</p>
            `;

            if (plan === 'combo-dupla' || plan === 'combo-familia') {
                reviewHtml += `<hr class="my-2"><h4 class="font-bold text-purple-700">Dependentes do Combo:</h4>`;
                const d1Name = document.getElementById('dep1Name').value;
                const d1Kin = document.getElementById('dep1Kinship').value;
                reviewHtml += `<p class="text-xs ml-2">- ${d1Name} (${d1Kin})</p>`;
                if (plan === 'combo-familia') {
                    const d2Name = document.getElementById('dep2Name').value;
                    const d2Kin = document.getElementById('dep2Kinship').value;
                    reviewHtml += `<p class="text-xs ml-2">- ${d2Name} (${d2Kin})</p>`;
                }
            }

            document.getElementById('reviewContent').innerHTML = reviewHtml;
            document.getElementById('confirmationModal').classList.remove('hidden');
        }

        window.closeConfirmation = function() { 
            document.getElementById('confirmationModal').classList.add('hidden'); 
        }

        window.populateContractDOM = function(s) {
            let price = "R$ 0,00";
            if(s.plan === 'infantil-mensal') price = "R$ 189,90";
            else if(s.plan === 'infantil-trimestral') price = "R$ 168,90";
            else if(s.plan === 'infantil-semestral') price = "R$ 157,90";
            else if(s.plan === 'adulto-mensal') price = "R$ 168,90";
            else if(s.plan === 'adulto-trimestral') price = "R$ 147,90";
            else if(s.plan === 'adulto-semestral') price = "R$ 126,90";
            else if(s.plan === 'combo-dupla') price = "R$ 250,00";
            else if(s.plan === 'combo-familia') price = "R$ 362,02";
            
            let promoNote = "";
            if (s.plan && s.plan.includes('semestral') && !s.plan.includes('combo')) {
                promoNote = "OBS: Promo√ß√£o de Inaugura√ß√£o aplicada. A 1¬™ Mensalidade ter√° o valor reduzido de R$ 29,90.";
            } else if (s.plan === 'combo-dupla') {
                promoNote = "OBS: Promo√ß√£o de Inaugura√ß√£o aplicada. A 1¬™ Mensalidade ter√° o valor reduzido de R$ 59,90.";
            } else if (s.plan === 'combo-familia') {
                promoNote = "OBS: Promo√ß√£o de Inaugura√ß√£o aplicada. A 1¬™ Mensalidade ter√° o valor reduzido de R$ 89,90.";
            }

            let dobDate;
            if (s.dob && s.dob.includes('T')) {
                 dobDate = new Date(s.dob);
            } else if (s.dob) {
                 const [y, m, d] = s.dob.split('-').map(Number);
                 dobDate = new Date(y, m - 1, d);
            } else {
                 dobDate = new Date();
            }
            
            const formattedDob = `${dobDate.getDate().toString().padStart(2,'0')}/${(dobDate.getMonth()+1).toString().padStart(2,'0')}/${dobDate.getFullYear()}`;
            
            document.getElementById('printContratante').innerText = s.guardian || s.titularName || s.name;
            document.getElementById('printStudent').innerText = s.name;
            document.getElementById('printDob').innerText = formattedDob;
            document.getElementById('printCPF').innerText = s.cpf || "N√£o informado";
            document.getElementById('printEmail').innerText = s.email || "N√£o informado";
            document.getElementById('printPhone').innerText = s.phone || "N√£o informado";
            document.getElementById('printAddress').innerText = s.address || "N√£o informado";
            
            let displayName = 'N√ÉO INFORMADO';
            if(s.plan) {
                if(s.plan === 'combo-dupla') displayName = 'COMBO DUPLA (1 ADULTO + 1 INFANTIL) SEMESTRAL';
                else if(s.plan === 'combo-familia') displayName = 'COMBO FAM√çLIA (2 ADULTOS + 1 INFANTIL) SEMESTRAL';
                else if(s.plan === 'administracao') displayName = 'ADMINISTRA√á√ÉO (ISENTO)';
                else if(s.plan === 'dependente') displayName = 'DEPENDENTE - COMBO FAM√çLIA';
                else displayName = s.plan.replace('infantil-', 'Infantil ').replace('adulto-', 'Jovem/Adulto ').replace('mensal', 'Mensal').replace('trimestral', 'Trimestral').replace('semestral', 'Semestral').toUpperCase();
            }
            
            let beltInfo = "";
            if(s.belt && !s.belt.includes("Branca - 0¬∫ Grau") && !s.belt.includes("Iniciante")) {
                beltInfo = `| Gradua√ß√£o Atual: ${s.belt}`;
            }
            document.getElementById('printBeltInfo').innerText = beltInfo;
            
            const regDate = s.registrationDate ? new Date(s.registrationDate) : new Date();
            const options = { day: 'numeric', month: 'long', year: 'numeric' };
            document.getElementById('printContractDate').innerText = regDate.toLocaleDateString('pt-BR', options);

            // LOGICA PARA INJETAR CLAUSULAS DINAMICAS E NUMERADAS
            const isCombo = s.plan && s.plan.includes('combo');
            const isFidelity = s.plan && (s.plan.includes('semestral') || s.plan.includes('trimestral') || isCombo);
            const safePaymentMethod = s.paymentMethod || "DEFINIDO NO ATO DA MATR√çCULA";

            let clausesHtml = `<p><strong>CL√ÅUSULA 1¬™ - DO OBJETO:</strong> O presente contrato tem por objeto a presta√ß√£o de servi√ßos de ensino e treinamento da arte marcial <strong>JIU-JITSU</strong> pela CONTRATADA ao(s) ALUNO(S) qualificado(s) acima, disponibilizando espa√ßo f√≠sico adequado, instrutores capacitados e hor√°rios pr√©-estabelecidos conforme a grade vigente.</p>`;

            clausesHtml += `<p><strong>CL√ÅUSULA 2¬™ - DO PLANO E VALORES:</strong> O CONTRATANTE opta pelo plano esportivo <strong class="uppercase underline">${displayName}</strong>, comprometendo-se ao pagamento da mensalidade no valor de <strong class="bg-yellow-100 px-1">${price}</strong>. O vencimento ocorrer√° todo dia <strong>${regDate.getDate()}</strong> de cada m√™s corrente. Via de pagamento acordada: <strong>${safePaymentMethod}</strong>.</p>`;

            if (promoNote) {
                 clausesHtml += `<p class="italic text-xs font-bold mb-3">${promoNote}</p>`;
            }

            let clauseNum = 3;

            if (isFidelity) {
                clausesHtml += `<p><strong>CL√ÅUSULA ${clauseNum}¬™ - DO CANCELAMENTO E DA QUEBRA DE CONTRATO (FIDELIDADE):</strong> O plano escolhido possui prazo de fidelidade. O cancelamento exige aviso pr√©vio de 30 dias por escrito. A rescis√£o imotivada antes do t√©rmino do per√≠odo de fidelidade contratado acarretar√° multa rescis√≥ria de 20% (vinte por cento) calculada sobre o valor total das parcelas vincendas (restantes) do contrato.</p>`;
                clauseNum++;
            } else {
                clausesHtml += `<p><strong>CL√ÅUSULA ${clauseNum}¬™ - DO CANCELAMENTO:</strong> O cancelamento da presta√ß√£o de servi√ßos exige aviso pr√©vio de 30 (trinta) dias por escrito √† secretaria da academia. N√£o haver√° reembolso de valores pagos retroativos caso o aluno deixe de frequentar as aulas sem aviso pr√©vio formalizado.</p>`;
                clauseNum++;
            }

            if (isCombo) {
                clausesHtml += `<div class="bg-blue-50 p-2 border-l-2 border-blue-400"><p><strong>CL√ÅUSULA ${clauseNum}¬™ - DAS REGRAS DO PLANO FAM√çLIA (COMBO):</strong> Por se tratar de um pacote promocional vinculado a um grupo familiar:<br>
                a) O pagamento deve ser realizado de forma √∫nica e integral pelo CONTRATANTE (Titular).<br>
                b) O cancelamento, trancamento ou inadimpl√™ncia de UM dos benefici√°rios n√£o d√° direito a reembolso proporcional.<br>
                c) Em caso de sa√≠da de um membro do Combo, o plano dos membros restantes ser√° automaticamente revertido para a tabela de pre√ßos individuais vigente no m√™s do evento.</p></div>`;
                clauseNum++;
            }

            clausesHtml += `<p><strong>CL√ÅUSULA ${clauseNum}¬™ - DA INADIMPL√äNCIA:</strong> O atraso superior a 30 dias no pagamento da mensalidade poder√° acarretar a suspens√£o imediata do acesso aos treinos e cobran√ßa dos valores devidos acrescidos de multa de 2% e juros de mora legais.</p>`;
            clauseNum++;

            clausesHtml += `<p><strong>CL√ÅUSULA ${clauseNum}¬™ - DA SA√öDE E APTID√ÉO F√çSICA:</strong> O CONTRATANTE atesta que o(s) Aluno(s) encontra(m)-se em plenas condi√ß√µes de sa√∫de f√≠sica e mental para a pr√°tica de esportes de combate, isentando a CONTRATADA de qualquer responsabilidade sobre mol√©stias pr√©-existentes n√£o declaradas formalmente no ato desta matr√≠cula.</p>`;
            clauseNum++;

            clausesHtml += `<p><strong>CL√ÅUSULA ${clauseNum}¬™ - DAS REGRAS DE CONDUTA (DOJO KUN):</strong> √â obrigat√≥rio o uso de uniforme (Kimono) estipulado pela academia, limpo e conservado. Atos de indisciplina, desrespeito √† hierarquia, agress√£o fora do contexto do treino esportivo ou falta de higiene poder√£o acarretar na suspens√£o ou rescis√£o unilateral deste contrato por parte da CONTRATADA, sem devolu√ß√£o de valores.</p>`;
            clauseNum++;

            clausesHtml += `<p><strong>CL√ÅUSULA ${clauseNum}¬™ - DO DIREITO DE IMAGEM:</strong> O CONTRATANTE autoriza, a t√≠tulo gratuito, o uso de imagem, voz e nome do(s) Aluno(s) captados nas depend√™ncias da academia ou em eventos externos, para fins de publicidade e marketing da Tanque Team BJJ.</p>`;

            document.getElementById('print-clauses-container').innerHTML = clausesHtml;

            // Dependents Block
            let dependentsHtml = '';
            if (isCombo) {
                // Em tempo de matr√≠cula online, a vari√°vel window.students n√£o tem dados. Pegamos os inputs.
                dependentsHtml = `<p class="mt-2 text-sm"><strong>DEPENDENTES VINCULADOS AO PLANO:</strong></p><ul class="list-disc pl-5 mt-1 text-xs">`;
                
                const d1Name = document.getElementById('dep1Name').value;
                const d1Dob = document.getElementById('dep1Dob').value;
                const d1Kin = document.getElementById('dep1Kinship').value;
                const d1BeltCheck = document.getElementById('dep1HasBelt').checked;
                const d1Belt = d1BeltCheck ? `Faixa ${document.getElementById('dep1Color').value} - ${document.getElementById('dep1Degree').value}¬∫ Grau` : 'Branca';
                let d1FormatDob = '--/--/----';
                if(d1Dob) { const [y, m, day] = d1Dob.split('-').map(Number); d1FormatDob = `${day.toString().padStart(2,'0')}/${(m).toString().padStart(2,'0')}/${y}`; }
                
                dependentsHtml += `<li><strong>${d1Name}</strong> - Nasc: ${d1FormatDob} | Parentesco: ${d1Kin} | Gradua√ß√£o: ${d1Belt}</li>`;

                if (s.plan === 'combo-familia') {
                    const d2Name = document.getElementById('dep2Name').value;
                    const d2Dob = document.getElementById('dep2Dob').value;
                    const d2Kin = document.getElementById('dep2Kinship').value;
                    const d2BeltCheck = document.getElementById('dep2HasBelt').checked;
                    const d2Belt = d2BeltCheck ? `Faixa ${document.getElementById('dep2Color').value} - ${document.getElementById('dep2Degree').value}¬∫ Grau` : 'Branca';
                    let d2FormatDob = '--/--/----';
                    if(d2Dob) { const [y, m, day] = d2Dob.split('-').map(Number); d2FormatDob = `${day.toString().padStart(2,'0')}/${(m).toString().padStart(2,'0')}/${y}`; }
                    
                    dependentsHtml += `<li><strong>${d2Name}</strong> - Nasc: ${d2FormatDob} | Parentesco: ${d2Kin} | Gradua√ß√£o: ${d2Belt}</li>`;
                }
                dependentsHtml += `</ul>`;
            }
            document.getElementById('printDependentsBlock').innerHTML = dependentsHtml;

            // SIGNATURE NAME
            const signName = s.guardian || s.titularName || s.name;
            document.getElementById('printSignatureName').innerText = signName;
        };

        window.finalizeRegistration = async function() {
            const confirmBtn = document.getElementById('finalConfirmBtn');
            const originalBtnText = "Tudo Certo, Matricular";
            
            confirmBtn.innerText = "Processando...";
            confirmBtn.disabled = true;
            confirmBtn.classList.add('opacity-75', 'cursor-not-allowed');

            try {
                const today = new Date();
                
                const plan = document.getElementById('selectedPlanInput').value;
                const displayName = document.getElementById('selectedPlanCustomName').value;
                const studentName = document.getElementById('studentName').value;
                const studentDob = document.getElementById('studentDob').value;
                
                const age = validateAge();
                let planIsInfantil = plan && plan.includes('infantil') && !plan.includes('combo');
                const needsGuardian = age < 18 || planIsInfantil;
                
                const guardianName = needsGuardian ? document.getElementById('guardianName').value : "";
                const guardianKinship = needsGuardian ? document.getElementById('guardianKinship').value : "";
                
                const cpf = document.getElementById('cpfInput').value;
                const email = document.getElementById('emailInput').value;
                const phone = document.getElementById('phoneInput').value;
                const address = document.getElementById('addressInput').value;
                const paymentMethod = document.getElementById('paymentMethod').value;
                const contratanteName = needsGuardian ? guardianName : studentName;

                let price = "R$ 0,00";
                if(plan === 'infantil-mensal') price = "R$ 189,90";
                else if(plan === 'infantil-trimestral') price = "R$ 168,90";
                else if(plan === 'infantil-semestral') price = "R$ 157,90";
                else if(plan === 'adulto-mensal') price = "R$ 168,90";
                else if(plan === 'adulto-trimestral') price = "R$ 147,90";
                else if(plan === 'adulto-semestral') price = "R$ 126,90";
                else if(plan === 'combo-dupla') price = "R$ 250,00";
                else if(plan === 'combo-familia') price = "R$ 362,02";

                let promoNote = "";
                if (plan && plan.includes('semestral') && !plan.includes('combo')) {
                    promoNote = " (1¬™ Mensalidade R$ 29,90)";
                } else if (plan === 'combo-dupla') {
                    promoNote = " (1¬™ Mensalidade R$ 59,90)";
                } else if (plan === 'combo-familia') {
                    promoNote = " (1¬™ Mensalidade R$ 89,90)";
                }

                const hasGraduation = document.getElementById("hasGraduationCheck").checked;
                const beltColor = hasGraduation ? document.getElementById("beltColor").value : "Branca";
                const beltDegree = hasGraduation ? document.getElementById("beltDegree").value : "0";
                const graduationText = `Faixa ${beltColor} - ${beltDegree}¬∫ Grau`;

                const dobParts = studentDob.split('-');
                const formattedDob = `${dobParts[2]}/${dobParts[1]}/${dobParts[0]}`;

                const regDate = new Date();
                let endDate = new Date(regDate);
                if(plan.includes('mensal')) endDate.setMonth(endDate.getMonth() + 1);
                else if(plan.includes('trimestral')) endDate.setMonth(endDate.getMonth() + 3);
                else endDate.setMonth(endDate.getMonth() + 6); // All Combos are 6 months

                let category = 'Adulto';
                if(plan.includes('infantil')) category = 'Infantil';
                if(plan.includes('combo')) category = 'Combo Fam√≠lia';

                const studentData = {
                    name: studentName,
                    dob: studentDob,
                    cpf: cpf,
                    belt: graduationText,
                    plan: plan,
                    category: category,
                    registrationDate: regDate.toISOString(),
                    contractEndDate: endDate.toISOString(),
                    email: email,
                    phone: phone,
                    address: address,
                    guardian: guardianName,
                    guardianKinship: guardianKinship,
                    paymentStatus: 'Pendente',
                    paymentMethod: paymentMethod
                };

                let titularDocRef = null;

                try {
                    if (window.firebaseInitialized && window.addDoc) {
                        titularDocRef = await window.addDoc(window.collection(window.db, 'artifacts', window.appId, 'public', 'data', 'students'), studentData);
                        
                        // Save Dependents
                        if (plan === 'combo-dupla' || plan === 'combo-familia') {
                            const dep1Data = {
                                name: document.getElementById('dep1Name').value,
                                dob: document.getElementById('dep1Dob').value,
                                titularName: studentName,
                                titularId: titularDocRef.id,
                                parentesco: document.getElementById('dep1Kinship').value,
                                belt: document.getElementById("dep1HasBelt").checked ? `Faixa ${document.getElementById('dep1Color').value} - ${document.getElementById('dep1Degree').value}¬∫ Grau` : "Iniciante/Faixa Branca",
                                plan: 'dependente',
                                category: 'Dependente',
                                registrationDate: regDate.toISOString(),
                                contractEndDate: endDate.toISOString(),
                                paymentStatus: 'Isento',
                                email: email,
                                phone: phone
                            };
                            await window.addDoc(window.collection(window.db, 'artifacts', window.appId, 'public', 'data', 'students'), dep1Data);
                        }
                        
                        if (plan === 'combo-familia') {
                            const dep2Data = {
                                name: document.getElementById('dep2Name').value,
                                dob: document.getElementById('dep2Dob').value,
                                titularName: studentName,
                                titularId: titularDocRef.id,
                                parentesco: document.getElementById('dep2Kinship').value,
                                belt: document.getElementById("dep2HasBelt").checked ? `Faixa ${document.getElementById('dep2Color').value} - ${document.getElementById('dep2Degree').value}¬∫ Grau` : "Iniciante/Faixa Branca",
                                plan: 'dependente',
                                category: 'Dependente',
                                registrationDate: regDate.toISOString(),
                                contractEndDate: endDate.toISOString(),
                                paymentStatus: 'Isento',
                                email: email,
                                phone: phone
                            };
                            await window.addDoc(window.collection(window.db, 'artifacts', window.appId, 'public', 'data', 'students'), dep2Data);
                        }
                    }
                } catch(err) {
                    console.error("Erro ao salvar no banco (continuando fluxo):", err);
                }

                document.getElementById('modalClientName').innerText = studentName; 
                document.getElementById('modalPlanName').innerText = displayName;

                window.populateContractDOM(studentData);

                // --- EMAIL SENDING ---
                let dependentsHtmlEmail = '';
                if (plan === 'combo-dupla' || plan === 'combo-familia') {
                    dependentsHtmlEmail = `<h4 style="color: #D90429; margin-bottom: 5px;">Dependentes Cadastrados:</h4><ul>`;
                    const d1N = document.getElementById('dep1Name').value;
                    const d1K = document.getElementById('dep1Kinship').value;
                    dependentsHtmlEmail += `<li>${d1N} (${d1K})</li>`;
                    if (plan === 'combo-familia') {
                        const d2N = document.getElementById('dep2Name').value;
                        const d2K = document.getElementById('dep2Kinship').value;
                        dependentsHtmlEmail += `<li>${d2N} (${d2K})</li>`;
                    }
                    dependentsHtmlEmail += `</ul>`;
                }

                const messageStudent = `<div style="font-family: Arial, sans-serif; color: #333; max-width: 600px; margin: 0 auto;"><div style="text-align: center; margin-bottom: 20px; background-color: #000; padding: 20px; border-radius: 8px 8px 0 0;"><img src="https://i.ibb.co/spgfD2Nd/1771300330359.png" alt="Tanque Team BJJ" style="width: 100px; height: auto;"><h2 style="color: #fff; margin: 10px 0 0 0;">TANQUE TEAM BJJ</h2></div><h2 style="color: #D90429;">Ol√°, ${studentName}!</h2><p>√â com grande satisfa√ß√£o que confirmamos a sua pr√©-matr√≠cula na <strong>Tanque Team BJJ</strong>! üëä</p><p>Voc√™ acaba de dar o primeiro passo na sua jornada no Jiu-Jitsu. Mais do que t√©cnica, aqui voc√™ encontrar√° disciplina, fam√≠lia e um tatame preparado para o seu desenvolvimento.</p><div style="background-color: #f8f9fa; border-left: 5px solid #D90429; padding: 15px; margin: 20px 0; border-radius: 4px;"><h3 style="margin-top: 0; color: #D90429; border-bottom: 1px solid #ddd; padding-bottom: 10px;">‚úÖ Resumo da sua Matr√≠cula</h3><p style="margin: 5px 0;"><strong>Titular:</strong> ${studentName}</p><p style="margin: 5px 0;"><strong>Plano:</strong> ${displayName}</p><p style="margin: 5px 0;"><strong>Valor:</strong> ${price} <span style="color: #D90429; font-weight: bold;">${promoNote}</span></p><p style="margin: 5px 0;"><strong>Pagamento:</strong> ${paymentMethod}</p><p style="margin: 5px 0;"><strong>Nascimento:</strong> ${formattedDob}</p><p style="margin: 5px 0;"><strong>Gradua√ß√£o:</strong> ${graduationText}</p><hr style="border: 0; border-top: 1px solid #eee; margin: 10px 0;">${needsGuardian ? `<p style="margin: 5px 0;"><strong>Respons√°vel:</strong> ${guardianName} (${guardianKinship})</p>` : ''}<p style="margin: 5px 0;"><strong>CPF:</strong> ${cpf}</p><p style="margin: 5px 0;"><strong>Email:</strong> ${email}</p><p style="margin: 5px 0;"><strong>Telefone:</strong> ${phone}</p><p style="margin: 5px 0;"><strong>Endere√ßo:</strong> ${address}</p>${dependentsHtmlEmail}</div><div style="background-color: #fff3cd; color: #856404; padding: 15px; border-radius: 4px; margin-bottom: 20px; border: 1px solid #ffeeba;"><h3 style="margin-top: 0;">üí∞ Informa√ß√£o de Pagamento</h3><p style="margin: 0;">Para concluir a ativa√ß√£o do seu plano e retirar seu patch, por favor realize o pagamento <strong>presencialmente na unidade</strong> ou entre em contato atrav√©s do nosso <strong>WhatsApp</strong>.</p></div><h3 style="color: #D90429;">üìã Pr√≥ximos Passos:</h3><ul><li style="margin-bottom: 8px;"><strong>Uniforme:</strong> Caso ainda n√£o tenha, nossa equipe est√° pronta para ajudar com o seu kimono.</li><li style="margin-bottom: 8px;"><strong>Primeiro Treino:</strong> Chegue 15 minutos antes para se ambientar e conhecer o professor.</li><li style="margin-bottom: 8px;"><strong>Higiene:</strong> Lembre-se de trazer chinelos para circular fora do tatame.</li></ul><div style="background-color: #e8f5e9; padding: 15px; border-radius: 8px; margin-top: 20px;"><p style="margin: 0;"><strong>üìç Localiza√ß√£o:</strong> <a href="https://maps.app.goo.gl/Qr4yLUTsVaZPiery9" style="color: #2e7d32; text-decoration: none;">Rua Jos√© Custodio de Almeida, N¬∫ 9 - Parque Verde - Bel√©m-PA</a></p></div><p style="margin-top: 20px;">Se tiver d√∫vidas, responda a este e-mail ou entre em contato pelo WhatsApp: <a href="https://wa.me/5591998192610" style="color: #25D366; font-weight: bold; text-decoration: none;">(91) 99819-2610</a>.</p><p style="font-size: 1.2em;">Estamos ansiosos para te ver no tatame!<br><strong>OSS!</strong></p><hr style="border: 0; border-top: 1px solid #ccc; margin: 30px 0;"><p style="font-size: 12px; color: #777; text-align: center;">Atenciosamente,<br>Equipe Tanque Team BJJ</p></div>`;

                const messageAdmin = `NOVA MATR√çCULA REALIZADA (C√≥pia Admin):\n-----------------------------------\nAluno/Titular: ${studentName}\nNascimento: ${formattedDob}\nGradua√ß√£o: ${graduationText}\n${needsGuardian ? `Respons√°vel: ${guardianName} (${guardianKinship})` : ''}\nCPF: ${cpf}\nEmail: ${email}\nTelefone: ${phone}\nEndere√ßo: ${address}\n\nDETALHES DO PLANO:\n-----------------------------------\nPlano: ${displayName}\nValor: ${price} ${promoNote}\nPagamento: ${paymentMethod}\nData: ${today.toLocaleDateString('pt-BR')}\n\nStatus: Contrato Assinado Digitalmente.`;

                const paramsStudent = { to_name: contratanteName, to_email: email, plan_name: displayName, reply_to: 'contato@tanqueteambjj.com', subject: `ü•ã Bem-vindo √† Fam√≠lia! Confirma√ß√£o de Matr√≠cula - ${studentName}`, message: messageStudent };
                const paramsAdmin = { to_name: "Administra√ß√£o", to_email: 'cledson.sales@gmail.com', plan_name: displayName, reply_to: email, subject: `Nova Matr√≠cula: ${studentName} - ${displayName}`, message: messageAdmin };

                const timeoutPromise = new Promise((_, reject) => setTimeout(() => reject(new Error("Timeout")), 7000));
                
                const emailPromise = Promise.all([
                    emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, paramsStudent, EMAILJS_PUBLIC_KEY),
                    emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, paramsAdmin, EMAILJS_PUBLIC_KEY)
                ]);

                try {
                     await Promise.race([emailPromise, timeoutPromise]);
                     const emailMsg = document.getElementById('email-status-msg');
                     if(emailMsg) { emailMsg.className = "text-sm text-green-600 mt-2 font-semibold"; emailMsg.innerHTML = `<i class="fa-solid fa-envelope-circle-check"></i> Matr√≠cula confirmada! E-mail enviado para ${email}.`; }
                } catch (e) {
                     console.log("Email status:", e.message); 
                     const emailMsg = document.getElementById('email-status-msg');
                     if(emailMsg) { emailMsg.className = "text-sm text-red-600 mt-2 font-semibold bg-red-100 p-2 rounded border border-red-200"; emailMsg.innerHTML = '<i class="fa-solid fa-triangle-exclamation"></i> <strong>Aviso:</strong> A matr√≠cula foi gerada, mas houve uma demora no envio do e-mail.'; }
                }

                window.closeConfirmation();
                document.getElementById('successModal').classList.remove('hidden');

            } catch (e) {
                alert("Erro inesperado: " + e.message);
            } finally {
                confirmBtn.innerText = originalBtnText;
                confirmBtn.disabled = false;
                confirmBtn.classList.remove('opacity-75', 'cursor-not-allowed');
            }
        }

        window.closeModal = function() {
            document.getElementById('successModal').classList.add('hidden');
            document.getElementById('registrationForm').reset();
            document.getElementById('plan-summary').classList.add('hidden');
            document.getElementById('guardianContainer').classList.add('hidden');
            document.getElementById('dependentsSection').classList.add('hidden');
            document.getElementById('dep1Container').classList.add('hidden');
            document.getElementById('dep2Container').classList.add('hidden');
            document.getElementById('combo-alert').classList.add('hidden');
            toggleGraduationFields();
        }

    </script>
</body>
</html>
