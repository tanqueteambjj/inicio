<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tanque Team Jiu-Jitsu | Matr√≠cula Online</title>
    
    <!-- Favicon -->
    <link rel="icon" href="https://i.ibb.co/spgfD2Nd/1771300330359.png" type="image/png">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;600;700&family=Roboto:wght@300;400;500;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, doc, deleteDoc, updateDoc, query, orderBy, where } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        try {
            const manualConfig = {
                apiKey: "AIzaSyCWlrrfNn6q4GhhL2H7goHjQMd3MsprxOE",
                authDomain: "tanqueteambjj.firebaseapp.com",
                projectId: "tanqueteambjj",
                storageBucket: "tanqueteambjj.firebasestorage.app",
                messagingSenderId: "410605992451",
                appId: "1:410605992451:web:f0f341f4594fe75f376c36",
                measurementId: "G-SW8PP8X7WM"
            };

            const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : manualConfig;
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'tanqueteam-bjj';

            const isConfigured = firebaseConfig && firebaseConfig.apiKey !== "SUA_API_KEY_AQUI";

            if (isConfigured) {
                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app);
                const db = getFirestore(app);

                const initAuth = async () => {
                    try {
                        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                            await signInWithCustomToken(auth, __initial_auth_token);
                        } else {
                            await signInAnonymously(auth);
                        }
                    } catch (e) {
                        console.error("Erro na autentica√ß√£o Firebase:", e);
                    }
                };
                initAuth();

                window.db = db;
                window.collection = collection;
                window.addDoc = addDoc;
                window.getDocs = getDocs;
                window.deleteDoc = deleteDoc;
                window.updateDoc = updateDoc;
                window.doc = doc;
                window.query = query;
                window.orderBy = orderBy;
                window.where = where;
                window.appId = appId;
                window.firebaseInitialized = true;
            } else {
                console.warn("Firebase Config n√£o configurada corretamente.");
                window.firebaseInitialized = false;
            }
        } catch (error) {
            console.error("Erro cr√≠tico ao inicializar Firebase:", error);
            window.firebaseInitialized = false;
        }
    </script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            red: '#D90429',
                            dark: '#1B1B1B',
                            gray: '#2B2D42',
                            light: '#EDF2F4'
                        }
                    },
                    fontFamily: {
                        sans: ['Roboto', 'sans-serif'],
                        display: ['Oswald', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    }
                }
            }
        }
    </script>

    <style>
        .hero-bg {
            background-image: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('https://images.unsplash.com/photo-1564415315949-7a0c4c73aab4?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        
        .signature-font {
            font-family: 'Brush Script MT', cursive;
            font-size: 1.5rem;
            color: #000;
        }

        .contract-scroll::-webkit-scrollbar { width: 8px; }
        .contract-scroll::-webkit-scrollbar-track { background: #f1f1f1; }
        .contract-scroll::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        .contract-scroll::-webkit-scrollbar-thumb:hover { background: #555; }

        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        @media print {
            @page { margin: 1cm; size: auto; }
            nav, #home, #about, #plans, #register, footer, #successModal, #confirmationModal, #admin-login-modal, #student-login-modal, #student-dashboard, #edit-modal, #admin-register-modal, #graduation-modal, #details-modal, .no-print { display: none !important; }
            body { background: white; padding: 0; margin: 0; }

            /* Contract Mode */
            body:not(.printing-report) #printable-contract {
                position: absolute; left: 0; top: 0; width: 100%; display: block !important; visibility: visible;
                background: white; color: black; padding: 0; margin: 0; font-size: 10pt; line-height: 1.3;
            }
            body:not(.printing-report) #printable-contract * { visibility: visible; }
            body:not(.printing-report) #admin-dashboard { display: none !important; }

            #printable-contract h1 { font-size: 18pt; margin-bottom: 0.2rem; }
            #printable-contract h2 { font-size: 12pt; margin-bottom: 1rem; margin-top: 0.5rem; }
            #printable-contract .header-section { margin-bottom: 1rem; border-bottom-width: 1px; padding-bottom: 0.5rem; }
            #printable-contract .parties-section { margin-bottom: 1rem; font-size: 9pt; }
            #printable-contract .clauses-section { margin-bottom: 1rem; gap: 0.5rem; }
            #printable-contract .clauses-section p { margin-bottom: 0.5rem; text-align: justify; }
            #printable-contract .signatures-section { margin-top: 2rem; }

            /* Report Mode */
            body.printing-report #printable-contract { display: none !important; }
            body.printing-report #admin-dashboard { 
                display: block !important; position: static; height: auto; overflow: visible; background: white; 
                visibility: visible; width: 100%;
            }
            body.printing-report #admin-dashboard * { visibility: visible; }
            
            body.printing-report #admin-controls, 
            body.printing-report button,
            body.printing-report .no-print-col,
            body.printing-report .stats-container, 
            body.printing-report .tabs-container { display: none !important; }
            
            body.printing-report table { width: 100%; border-collapse: collapse; font-size: 10pt; }
            body.printing-report th, body.printing-report td { border: 1px solid #000; padding: 6px; text-align: left; color: black; }
            body.printing-report th { background-color: #f3f3f3; font-weight: bold; }
        }
    </style>
</head>
<body class="bg-brand-light text-slate-800 font-sans antialiased">

    <!-- Navigation -->
    <nav class="bg-brand-dark text-white sticky top-0 z-50 shadow-lg">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <img src="https://i.ibb.co/spgfD2Nd/1771300330359.png" alt="Tanque Team Logo" class="w-12 h-12 object-contain filter drop-shadow-md">
                <span class="font-display text-2xl font-bold tracking-wider">TANQUE TEAM <span class="text-brand-red">BJJ</span></span>
            </div>
            
            <!-- Desktop Menu -->
            <div class="hidden md:flex items-center space-x-6 font-display uppercase tracking-wide text-sm">
                <a href="#home" class="hover:text-brand-red transition">In√≠cio</a>
                <a href="#about" class="hover:text-brand-red transition">A Metodologia</a>
                <a href="#plans" class="hover:text-brand-red transition">Planos</a>
                <!-- Link √Årea do Aluno com Destaque -->
                <a href="https://tanqueteambjj.github.io/inicio/login_aluno.html" class="bg-white text-brand-dark px-4 py-2 rounded font-bold hover:bg-gray-200 transition shadow-sm border border-gray-300 flex items-center gap-2">
                    <i class="fa-solid fa-user-lock"></i> √Årea do Aluno
                </a>
                <a href="#register" class="bg-brand-red px-5 py-2 rounded text-white hover:bg-red-700 transition">Matricule-se Agora</a>
            </div>

            <!-- Mobile Menu Button -->
            <button id="mobile-menu-btn" class="md:hidden text-2xl focus:outline-none"><i class="fa-solid fa-bars"></i></button>
        </div>
        
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-brand-dark pb-4 px-6 space-y-2">
            <a href="#home" class="block py-2 hover:text-brand-red">In√≠cio</a>
            <a href="#about" class="block py-2 hover:text-brand-red">A Metodologia</a>
            <a href="#plans" class="block py-2 hover:text-brand-red">Planos</a>
            <a href="https://tanqueteambjj.github.io/inicio/login_aluno.html" class="block py-2 text-white font-bold bg-gray-700 px-3 rounded"><i class="fa-solid fa-user-lock mr-2"></i>√Årea do Aluno</a>
            <a href="#register" class="block py-2 text-brand-red font-bold">Matricule-se</a>
        </div>
    </nav>

    <!-- Hero Section -->
    <section id="home" class="hero-bg h-screen flex items-center justify-center text-center px-4">
        <div class="max-w-4xl text-white fade-in">
            <h2 class="font-display text-lg md:text-2xl mb-4 tracking-widest uppercase text-brand-red">Disciplina ‚Ä¢ Respeito ‚Ä¢ T√©cnica</h2>
            <h1 class="font-display text-5xl md:text-7xl font-bold mb-6 leading-tight">DOMINE A <br>ARTE SUAVE</h1>
            <p class="text-gray-300 text-lg md:text-xl mb-8 max-w-2xl mx-auto">N√£o √© sobre for√ßa, √© sobre alavanca. Transforme sua mente e corpo na maior academia de Jiu-Jitsu da regi√£o.</p>
            <div class="flex flex-col md:flex-row gap-4 justify-center">
                <a href="#register" class="bg-brand-red text-white px-8 py-4 rounded font-bold font-display uppercase tracking-wider hover:bg-red-700 transition shadow-lg transform hover:-translate-y-1">Come√ßar Hoje</a>
                <a href="#about" class="border-2 border-white text-white px-8 py-4 rounded font-bold font-display uppercase tracking-wider hover:bg-white hover:text-brand-dark transition">Saiba Mais</a>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="py-20 bg-white">
        <div class="container mx-auto px-6">
            <div class="text-center mb-16">
                <h2 class="font-display text-4xl font-bold text-brand-dark mb-4">POR QUE A TANQUE TEAM?</h2>
                <div class="w-24 h-1 bg-brand-red mx-auto"></div>
            </div>
            <div class="grid md:grid-cols-3 gap-10">
                <div class="text-center p-6 border border-gray-100 rounded-xl shadow-sm hover:shadow-xl transition duration-300">
                    <div class="w-16 h-16 bg-brand-light rounded-full flex items-center justify-center mx-auto mb-6 text-brand-red text-2xl"><i class="fa-solid fa-user-ninja"></i></div>
                    <h3 class="font-display text-xl font-bold mb-3">Professores Faixa Preta</h3>
                    <p class="text-gray-600">Aprenda diretamente com mestres certificados e com experi√™ncia em competi√ß√µes internacionais.</p>
                </div>
                <div class="text-center p-6 border border-gray-100 rounded-xl shadow-sm hover:shadow-xl transition duration-300">
                    <div class="w-16 h-16 bg-brand-light rounded-full flex items-center justify-center mx-auto mb-6 text-brand-red text-2xl"><i class="fa-solid fa-shield-heart"></i></div>
                    <h3 class="font-display text-xl font-bold mb-3">Ambiente Seguro</h3>
                    <p class="text-gray-600">Foco total no respeito e na integridade f√≠sica do aluno. O Jiu-Jitsu √© para todos.</p>
                </div>
                <div class="text-center p-6 border border-gray-100 rounded-xl shadow-sm hover:shadow-xl transition duration-300">
                    <div class="w-16 h-16 bg-brand-light rounded-full flex items-center justify-center mx-auto mb-6 text-brand-red text-2xl"><i class="fa-solid fa-child-reaching"></i></div>
                    <h3 class="font-display text-xl font-bold mb-3">Metodologia Infantil</h3>
                    <p class="text-gray-600">Programas anti-bullying e desenvolvimento de autoconfian√ßa para crian√ßas a partir de 4 anos.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Plans Section -->
    <section id="plans" class="py-20 bg-gray-50">
        <div class="container mx-auto px-6">
            <div class="text-center mb-10">
                <h2 class="font-display text-4xl font-bold text-brand-dark mb-4">ESCOLHA SEU PLANO</h2>
                <div class="bg-brand-red text-white py-3 px-6 rounded-lg inline-block shadow-lg animate-pulse">
                    <h3 class="font-bold uppercase tracking-wider text-sm md:text-base">üéâ M√™s de Inaugura√ß√£o (Abril) üéâ</h3>
                    <p class="text-xs md:text-sm mt-1 font-medium">1¬∫ M√™s por apenas <strong>R$ 9,90</strong> em qualquer plano Semestral!</p>
                </div>
            </div>
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 max-w-7xl mx-auto">
                <!-- Plan 1 -->
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden border-t-4 border-gray-400 hover:shadow-xl transition duration-300 flex flex-col">
                    <div class="p-6 text-center flex-grow">
                        <h3 class="font-display text-xl font-bold text-gray-800 mb-1">INFANTIL</h3>
                        <p class="text-gray-500 text-xs font-bold uppercase mb-4 tracking-wide">Plano Mensal</p>
                        <div class="text-3xl font-bold text-brand-dark mb-4">R$ 179<span class="text-sm text-gray-400 font-normal">/m√™s</span></div>
                        <ul class="text-left space-y-2 mb-6 text-gray-600 text-xs">
                            <li class="flex items-center"><i class="fa-solid fa-check text-green-500 mr-2"></i> Metodologia Especializada</li>
                            <li class="flex items-center"><i class="fa-solid fa-check text-green-500 mr-2"></i> Desenvolvimento Disciplinar</li>
                            <li class="flex items-center"><i class="fa-solid fa-check text-green-500 mr-2"></i> Sem fidelidade</li>
                        </ul>
                        <p class="text-xs text-gray-400 mt-4 pt-4 border-t border-gray-100 font-medium">Idade: 4 a 11 anos</p>
                    </div>
                    <div class="p-6 pt-0"><button onclick="selectPlan('infantil-mensal', 179)" class="w-full py-2 border-2 border-brand-dark text-brand-dark font-bold rounded hover:bg-brand-dark hover:text-white transition">Selecionar</button></div>
                </div>
                <!-- Plan 2 -->
                <div class="bg-white rounded-2xl shadow-xl overflow-hidden border-t-4 border-brand-red transform md:-translate-y-2 relative flex flex-col">
                    <div class="absolute top-0 right-0 bg-brand-red text-white text-[10px] font-bold px-2 py-1 rounded-bl">OFERTA</div>
                    <div class="p-6 text-center flex-grow">
                        <h3 class="font-display text-xl font-bold text-brand-red mb-1">INFANTIL</h3>
                        <p class="text-gray-500 text-xs font-bold uppercase mb-4 tracking-wide">Plano Semestral</p>
                        <div class="text-3xl font-bold text-brand-dark mb-2">R$ 9,90<span class="text-sm text-gray-400 font-normal"> (1¬∫ m√™s)</span></div>
                        <div class="mb-4 bg-green-50 py-2 px-1 rounded border border-green-200">
                            <p class="text-xs text-green-700 font-bold">A partir do 2¬∫ m√™s: R$ 159,00/m√™s</p>
                            <p class="text-[10px] text-green-600 mt-1"><i class="fa-regular fa-clock"></i> Promo√ß√£o v√°lida at√© 30 de Abril</p>
                        </div>
                        <ul class="text-left space-y-2 mb-6 text-gray-600 text-xs">
                            <li class="flex items-center"><i class="fa-solid fa-check text-green-500 mr-2"></i> Valor Reduzido</li>
                            <li class="flex items-center"><i class="fa-solid fa-check text-green-500 mr-2"></i> Camiseta Gr√°tis</li>
                            <li class="flex items-center"><i class="fa-solid fa-check text-green-500 mr-2"></i> Fidelidade 6 Meses</li>
                        </ul>
                        <p class="text-xs text-gray-400 mt-4 pt-4 border-t border-gray-100 font-medium">Idade: 4 a 11 anos</p>
                    </div>
                    <div class="p-6 pt-0"><button onclick="selectPlan('infantil-semestral', 159)" class="w-full py-2 bg-brand-red text-white font-bold rounded hover:bg-red-700 transition shadow-lg">Selecionar</button></div>
                </div>
                <!-- Plan 3 -->
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden border-t-4 border-gray-400 hover:shadow-xl transition duration-300 flex flex-col">
                    <div class="p-6 text-center flex-grow">
                        <h3 class="font-display text-xl font-bold text-gray-800 mb-1">JOVEM/ADULTO</h3>
                        <p class="text-gray-500 text-xs font-bold uppercase mb-4 tracking-wide">Plano Mensal</p>
                        <div class="text-3xl font-bold text-brand-dark mb-4">R$ 139<span class="text-sm text-gray-400 font-normal">/m√™s</span></div>
                        <ul class="text-left space-y-2 mb-6 text-gray-600 text-xs">
                            <li class="flex items-center"><i class="fa-solid fa-check text-green-500 mr-2"></i> Acesso Livre</li>
                            <li class="flex items-center"><i class="fa-solid fa-check text-green-500 mr-2"></i> Todos os Hor√°rios</li>
                            <li class="flex items-center"><i class="fa-solid fa-check text-green-500 mr-2"></i> Sem fidelidade</li>
                        </ul>
                        <p class="text-xs text-gray-400 mt-4 pt-4 border-t border-gray-100 font-medium">Idade: 12 anos ou mais</p>
                    </div>
                    <div class="p-6 pt-0"><button onclick="selectPlan('adulto-mensal', 139)" class="w-full py-2 border-2 border-brand-dark text-brand-dark font-bold rounded hover:bg-brand-dark hover:text-white transition">Selecionar</button></div>
                </div>
                <!-- Plan 4 -->
                <div class="bg-white rounded-2xl shadow-xl overflow-hidden border-t-4 border-brand-red transform md:-translate-y-2 relative flex flex-col">
                    <div class="absolute top-0 right-0 bg-brand-red text-white text-[10px] font-bold px-2 py-1 rounded-bl">OFERTA</div>
                    <div class="p-6 text-center flex-grow">
                        <h3 class="font-display text-xl font-bold text-brand-red mb-1">JOVEM/ADULTO</h3>
                        <p class="text-gray-500 text-xs font-bold uppercase mb-4 tracking-wide">Plano Semestral</p>
                        <div class="text-3xl font-bold text-brand-dark mb-2">R$ 9,90<span class="text-sm text-gray-400 font-normal"> (1¬∫ m√™s)</span></div>
                        <div class="mb-4 bg-green-50 py-2 px-1 rounded border border-green-200">
                            <p class="text-xs text-green-700 font-bold">A partir do 2¬∫ m√™s: R$ 119,00/m√™s</p>
                            <p class="text-[10px] text-green-600 mt-1"><i class="fa-regular fa-clock"></i> Promo√ß√£o v√°lida at√© 30 de Abril</p>
                        </div>
                        <ul class="text-left space-y-2 mb-6 text-gray-600 text-xs">
                            <li class="flex items-center"><i class="fa-solid fa-check text-green-500 mr-2"></i> Melhor Custo-Benef√≠cio</li>
                            <li class="flex items-center"><i class="fa-solid fa-check text-green-500 mr-2"></i> Fidelidade 6 Meses</li>
                            <li class="flex items-center"><i class="fa-solid fa-check text-green-500 mr-2"></i> Camiseta Gr√°tis</li>
                        </ul>
                        <p class="text-xs text-gray-400 mt-4 pt-4 border-t border-gray-100 font-medium">Idade: 12 anos ou mais</p>
                    </div>
                    <div class="p-6 pt-0"><button onclick="selectPlan('adulto-semestral', 119)" class="w-full py-2 bg-brand-red text-white font-bold rounded hover:bg-red-700 transition shadow-lg">Selecionar</button></div>
                </div>
            </div>
        </div>
    </section>

    <!-- Registration Section -->
    <section id="register" class="py-20 bg-brand-dark text-white relative">
        <div class="container mx-auto px-6">
            <div class="flex flex-col md:flex-row gap-12">
                <div class="md:w-1/3">
                    <h2 class="font-display text-4xl font-bold mb-6">MATR√çCULA <span class="text-brand-red">ONLINE</span></h2>
                    <p class="text-gray-400 mb-8">Preencha seus dados para gerar seu contrato digital. Ao finalizar, sua matr√≠cula estar√° pr√©-aprovada.</p>
                    <div class="space-y-6">
                        <a href="https://maps.app.goo.gl/Qr4yLUTsVaZPiery9" target="_blank" class="flex items-center group hover:bg-gray-800 p-3 -ml-3 rounded-lg transition duration-300 cursor-pointer">
                            <div class="w-12 h-12 bg-gray-800 rounded-full flex items-center justify-center text-brand-red mr-4 group-hover:bg-brand-red group-hover:text-white transition duration-300"><i class="fa-solid fa-location-dot"></i></div>
                            <div><h4 class="font-bold group-hover:text-brand-red transition duration-300">Localiza√ß√£o <i class="fa-solid fa-arrow-up-right-from-square text-xs ml-1 opacity-50"></i></h4><p class="text-gray-400 text-sm group-hover:text-gray-200 transition duration-300">Rua Jos√© Custodio de Almeida, N¬∫ 9 <br>Parque Verde - <strong class="text-white">Bel√©m, Par√° (PA)</strong></p></div>
                        </a>
                        <a href="https://wa.me/5591998192610" target="_blank" class="flex items-center group hover:bg-gray-800 p-3 -ml-3 rounded-lg transition duration-300 cursor-pointer">
                            <div class="w-12 h-12 bg-gray-800 rounded-full flex items-center justify-center text-brand-red mr-4 group-hover:bg-brand-red group-hover:text-white transition duration-300"><i class="fa-brands fa-whatsapp"></i></div>
                            <div><h4 class="font-bold group-hover:text-brand-red transition duration-300">WhatsApp <i class="fa-solid fa-arrow-up-right-from-square text-xs ml-1 opacity-50"></i></h4><p class="text-gray-400 text-sm group-hover:text-gray-200 transition duration-300">(91) 99819-2610</p></div>
                        </a>
                    </div>
                    
                    <!-- Mapa embutido (Google Maps) -->
                    <div class="mt-8 bg-gray-800 p-4 rounded-lg border border-gray-700 shadow-inner hidden md:block">
                        <h4 class="text-white font-bold uppercase tracking-wider mb-3 text-sm flex items-center"><i class="fa-solid fa-map-location-dot text-brand-red mr-2 text-lg"></i> Nossa Unidade em <span class="text-brand-red ml-1">Bel√©m-PA</span></h4>
                        <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3988.6214531818274!2d-48.4533036!3d-1.373678!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x92a48ac11a76dc11%3A0x86bd615f1f7e0fc2!2sR.%20Jos%C3%A9%20Cust%C3%B3dio%20de%20Almeida%2C%209%20-%20Parque%20Verde%2C%20Bel%C3%A9m%20-%20PA%2C%2066635-110!5e0!3m2!1spt-BR!2sbr!4v1708260000000!5m2!1spt-BR!2sbr" width="100%" height="200" style="border:0; border-radius: 0.5rem;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                    </div>

                    <div id="plan-summary" class="mt-8 p-6 bg-gray-800 rounded-lg border border-gray-700 hidden">
                        <h4 class="text-gray-400 text-xs uppercase tracking-widest mb-2">Plano Selecionado</h4>
                        <div class="flex justify-between items-end">
                            <span id="summary-name" class="font-display text-2xl font-bold text-brand-red">---</span>
                            <span id="summary-price" class="text-xl">R$ 0,00</span>
                        </div>
                        <p id="promo-msg" class="text-green-400 text-xs mt-2 hidden"><i class="fa-solid fa-tag"></i> 1¬∫ M√™s por R$ 9,90 (Promo√ß√£o Abril)</p>
                    </div>
                </div>

                <div class="md:w-2/3 bg-white text-gray-800 rounded-xl shadow-2xl p-6 md:p-8">
                    <form id="registrationForm" onsubmit="openReviewModal(event)">
                        <h3 class="font-display text-xl font-bold mb-4 border-b pb-2">1. Dados do Aluno</h3>
                        <div class="grid md:grid-cols-2 gap-4 mb-4">
                            <div><label class="block text-sm font-bold mb-1 text-gray-600">Nome do Aluno</label><input type="text" id="studentName" required class="w-full bg-gray-100 border border-gray-300 rounded p-3 focus:outline-none focus:border-brand-red" placeholder="Nome completo do aluno"></div>
                            <div>
                                <label class="block text-sm font-bold mb-1 text-gray-600">Data de Nascimento</label>
                                <input type="date" id="studentDob" required onchange="validateAge()" class="w-full bg-gray-100 border border-gray-300 rounded p-3 focus:outline-none focus:border-brand-red text-gray-600">
                                <p id="age-validation-msg" class="text-red-600 text-xs mt-1 font-bold hidden"></p>
                            </div>
                        </div>
                        <div class="md:col-span-2 mb-4">
                            <label class="inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="hasGraduationCheck" onclick="toggleGraduationFields()" class="form-checkbox h-5 w-5 text-brand-red rounded border-gray-300 focus:ring-brand-red">
                                <span class="ml-2 text-gray-700 font-bold text-sm">J√° possui gradua√ß√£o (faixa)?</span>
                            </label>
                        </div>
                        <div id="graduationContainer" class="hidden grid md:grid-cols-2 gap-4 mb-6 p-4 bg-gray-50 border border-gray-200 rounded">
                            <div>
                                <label class="block text-sm font-bold mb-1 text-gray-600">Cor da Faixa</label>
                                <select id="beltColor" class="w-full bg-white border border-gray-300 rounded p-3 focus:outline-none focus:border-brand-red">
                                    <option value="" disabled selected>Selecione a cor</option>
                                    <option value="Branca">Branca</option>
                                    <option value="Cinza">Cinza</option>
                                    <option value="Amarela">Amarela</option>
                                    <option value="Laranja">Laranja</option>
                                    <option value="Verde">Verde</option>
                                    <option value="Azul">Azul</option>
                                    <option value="Roxa">Roxa</option>
                                    <option value="Marrom">Marrom</option>
                                    <option value="Preta">Preta</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-bold mb-1 text-gray-600">Grau(s)</label>
                                <select id="beltDegree" class="w-full bg-white border border-gray-300 rounded p-3 focus:outline-none focus:border-brand-red">
                                    <option value="0">0</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                </select>
                            </div>
                        </div>
                        <div id="guardianContainer" class="hidden mb-4 p-4 bg-gray-50 border border-gray-200 rounded">
                            <h4 class="text-sm font-bold text-brand-red mb-3 border-b border-gray-200 pb-1 uppercase">Respons√°vel Legal (Obrigat√≥rio para menores de 18)</h4>
                            <div class="mb-2"><label class="block text-sm font-bold mb-1 text-gray-600">Nome do Respons√°vel</label><input type="text" id="guardianName" class="w-full bg-white border border-gray-300 rounded p-3 focus:outline-none focus:border-brand-red" placeholder="Nome do pai, m√£e ou respons√°vel"></div>
                        </div>
                        <h3 class="font-display text-xl font-bold mb-4 border-b pb-2 mt-6">2. Dados Financeiros/Contato</h3>
                        <div class="grid md:grid-cols-2 gap-4 mb-4">
                            <div><label id="lblCpf" class="block text-sm font-bold mb-1 text-gray-600">CPF</label><input type="text" id="cpfInput" required maxlength="14" class="w-full bg-gray-100 border border-gray-300 rounded p-3 focus:outline-none focus:border-brand-red" placeholder="000.000.000-00"></div>
                            <div><label id="lblPhone" class="block text-sm font-bold mb-1 text-gray-600">Telefone</label><input type="tel" id="phoneInput" required maxlength="15" class="w-full bg-gray-100 border border-gray-300 rounded p-3 focus:outline-none focus:border-brand-red" placeholder="(91) 90000-0000"></div>
                            <div class="md:col-span-2"><label id="lblEmail" class="block text-sm font-bold mb-1 text-gray-600">E-mail</label><input type="email" id="emailInput" required class="w-full bg-gray-100 border border-gray-300 rounded p-3 focus:outline-none focus:border-brand-red" placeholder="seu@email.com" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$" title="Formato inv√°lido. Ex: nome@email.com"></div>
                        </div>
                        <div class="mb-6"><label class="block text-sm font-bold mb-1 text-gray-600">Endere√ßo Completo</label><input type="text" id="addressInput" required class="w-full bg-gray-100 border border-gray-300 rounded p-3 focus:outline-none focus:border-brand-red" placeholder="Rua, N√∫mero, Bairro, Cidade - Estado"></div>
                        
                        <!-- NEW PAYMENT METHOD SELECT -->
                        <div class="mb-6">
                            <label class="block text-sm font-bold mb-1 text-gray-600">Forma de Pagamento</label>
                            <select id="paymentMethod" required class="w-full bg-gray-100 border border-gray-300 rounded p-3 focus:outline-none focus:border-brand-red text-gray-700">
                                <option value="" disabled selected>Selecione a forma de pagamento...</option>
                                <optgroup label="Cr√©dito">
                                    <option value="Cr√©dito √† vista">Cr√©dito √† vista</option>
                                    <option value="Cr√©dito 2x">Cr√©dito 2x</option>
                                    <option value="Cr√©dito 3x">Cr√©dito 3x</option>
                                </optgroup>
                                <optgroup label="√Ä vista">
                                    <option value="Dinheiro">Dinheiro</option>
                                    <option value="Pix">Pix</option>
                                    <option value="D√©bito">D√©bito</option>
                                </optgroup>
                            </select>
                        </div>

                        <input type="hidden" id="selectedPlanInput" name="plan" required>
                        
                        <!-- Step 3: Contract (RESTORED) -->
                        <h3 class="font-display text-xl font-bold mb-4 border-b pb-2 mt-8">3. Contrato de Presta√ß√£o de Servi√ßos</h3>
                        
                        <div class="bg-gray-50 border border-gray-300 rounded p-4 h-64 overflow-y-scroll mb-4 text-sm text-gray-600 contract-scroll text-justify">
                            <p class="font-bold mb-2 text-center">CONTRATO DE ADES√ÉO E PRESTA√á√ÉO DE SERVI√áOS DE ENSINO ESPORTIVO</p>
                            
                            <p class="mb-2"><strong>CL√ÅUSULA 1¬™ ‚Äì DO OBJETO</strong><br>1.1. O presente contrato tem por objeto a presta√ß√£o de servi√ßos de ensino e treinamento de JIU-JITSU pela CONTRATADA ao CONTRATANTE, nas depend√™ncias da TANQUE TEAM BJJ.<br>1.2. As aulas ser√£o ministradas nos dias e hor√°rios estipulados na grade hor√°ria vigente, a qual poder√° sofrer altera√ß√µes mediante aviso pr√©vio da ACADEMIA.</p>
                            
                            <p class="mb-2"><strong>CL√ÅUSULA 2¬™ ‚Äì DO PLANO E PAGAMENTO</strong><br>2.1. O CONTRATANTE opta pelo plano selecionado na matr√≠cula.<br>2.2. O valor e forma de pagamento s√£o os definidos no ato da matr√≠cula.<br>2.3. As mensalidades dever√£o ser pagas at√© o dia 10 de cada m√™s.<br>2.4. Atrasos: O atraso no pagamento implicar√° em multa de 2% (dois por cento) e juros de mora de 1% (um por cento) ao m√™s. Ap√≥s 15 dias de atraso, o acesso √†s aulas poder√° ser bloqueado at√© a regulariza√ß√£o.</p>
                            
                            <p class="mb-2"><strong>CL√ÅUSULA 3¬™ ‚Äì DA SA√öDE E APTID√ÉO F√çSICA</strong><br>3.1. O CONTRATANTE declara, neste ato, estar em plenas condi√ß√µes f√≠sicas e mentais para a pr√°tica de atividades f√≠sicas, isentando a ACADEMIA de qualquer responsabilidade sobre problemas de sa√∫de pr√©-existentes n√£o informados.<br>3.2. O CONTRATANTE compromete-se a apresentar atestado m√©dico de aptid√£o f√≠sica no prazo m√°ximo de 15 (quinze) dias a contar da assinatura deste contrato, caso exigido pela legisla√ß√£o local.</p>
                            
                            <p class="mb-2"><strong>CL√ÅUSULA 4¬™ ‚Äì DO RISCO INERENTE √Ä PR√ÅTICA</strong><br>4.1. O CONTRATANTE declara estar ciente de que o Jiu-Jitsu √© um esporte de contato f√≠sico e combate, havendo risco inerente de contus√µes, les√µes ou acidentes durante os treinos, eximindo a ACADEMIA e seus instrutores de responsabilidade civil por acidentes decorrentes da pr√°tica normal e leal do esporte.</p>
                            
                            <p class="mb-2"><strong>CL√ÅUSULA 5¬™ ‚Äì DAS NORMAS DE CONDUTA E HIGIENE (DOJO KUN)</strong><br>5.1. √â obrigat√≥rio o uso de uniforme (Kimono/Gi ou No-Gi) adequado, limpo e em bom estado de conserva√ß√£o, respeitando as cores e padroniza√ß√µes da TANQUE TEAM BJJ.<br>5.2. O aluno deve manter a higiene pessoal em dia (unhas cortadas, cabelos limpos e presos, aus√™ncia de odores fortes), visando a seguran√ßa e o respeito aos colegas de treino.<br>5.3. A ACADEMIA reserva-se o direito de impedir o treino do aluno que n√£o estiver com a vestimenta adequada ou condi√ß√µes de higiene satisfat√≥rias.<br>5.4. Atos de indisciplina, desrespeito ao Mestre/Professor ou aos colegas, agress√µes fora das regras do esporte ou conduta imoral dentro das depend√™ncias acarretar√£o no cancelamento imediato deste contrato, sem devolu√ß√£o de valores pagos.</p>
                            
                            <p class="mb-2"><strong>CL√ÅUSULA 6¬™ ‚Äì DO DIREITO DE IMAGEM</strong><br>6.1. O CONTRATANTE autoriza, a t√≠tulo gratuito e por prazo indeterminado, o uso de sua imagem (fotos e v√≠deos) captada durante os treinos, gradua√ß√µes e campeonatos, para fins de divulga√ß√£o, publicidade e marketing da TANQUE TEAM BJJ em redes sociais, sites e materiais impressos.</p>
                            
                            <p class="mb-2"><strong>CL√ÅUSULA 7¬™ ‚Äì DO CANCELAMENTO E TRANCAMENTO</strong><br>7.1. Planos Mensais: O cancelamento deve ser solicitado com 30 (trinta) dias de anteced√™ncia.<br>7.2. Planos Fidelidade (Trimestral/Semestral/Anual): Em caso de cancelamento antecipado por iniciativa do aluno, ser√° cobrada uma multa correspondente a 20% (vinte por cento) sobre o valor restante do contrato.<br>7.3. N√£o haver√° reembolso de valores pagos caso o aluno deixe de frequentar as aulas por motivos pessoais sem formalizar o cancelamento junto √† secretaria.</p>
                            
                            <p class="mb-2"><strong>CL√ÅUSULA 8¬™ ‚Äì DISPOSI√á√ïES GERAIS</strong><br>8.1. A ACADEMIA n√£o se responsabiliza pela guarda de objetos pessoais, valores ou equipamentos deixados nas depend√™ncias do estabelecimento.<br>8.2. Este contrato tem validade a partir da data de sua assinatura.</p>
                            
                            <p class="mt-4 text-center italic">"O Jiu-Jitsu √© a arte de ser suave com quem √© suave, e duro com quem √© duro."</p>
                        </div>
                        
                        <!-- Step 4: Signature -->
                        <div class="bg-gray-100 p-4 rounded-lg border border-gray-200">
                            <div class="flex items-center mb-4"><input type="checkbox" id="termsCheck" required class="w-5 h-5 text-brand-red focus:ring-brand-red border-gray-300 rounded mr-2 cursor-pointer"><label for="termsCheck" class="text-sm font-semibold cursor-pointer select-none">Li e concordo com todos os termos do contrato acima.</label></div>
                            <div class="relative"><label class="block text-xs uppercase text-gray-500 mb-1">Assinatura Digital (Digite seu nome)</label><input type="text" id="signatureInput" oninput="updateSignaturePreview(this.value)" class="w-full border-b-2 border-gray-400 bg-transparent p-2 focus:outline-none focus:border-brand-red transition font-display" placeholder="Digite para assinar..."><div id="signaturePreview" class="signature-font text-gray-400 absolute right-4 top-8 pointer-events-none opacity-50 text-2xl"></div></div>
                        </div>
                        <button type="submit" id="submitBtn" class="w-full mt-6 bg-brand-red text-white font-bold py-4 rounded text-lg uppercase tracking-wider hover:bg-red-700 transition shadow-lg flex justify-center items-center gap-2"><span>Confirmar Matr√≠cula</span><i class="fa-solid fa-file-pen"></i></button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-black text-white py-10 border-t border-gray-900">
        <div class="container mx-auto px-6 text-center">
            <h2 class="font-display text-2xl font-bold mb-4">TANQUE TEAM <span class="text-brand-red">BJJ</span></h2>
            <div class="flex justify-center space-x-6 mb-8">
                <a href="#" class="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center hover:bg-brand-red transition"><i class="fa-brands fa-instagram"></i></a>
                <a href="#" class="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center hover:bg-brand-red transition"><i class="fa-brands fa-facebook-f"></i></a>
                <a href="#" class="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center hover:bg-brand-red transition"><i class="fa-brands fa-youtube"></i></a>
            </div>
            <div class="flex justify-center gap-4 text-xs text-gray-500 mb-4">
                <!-- <button onclick="openStudentLogin()" class="hover:text-gray-300">√Årea do Aluno</button> -->
                <a href="https://tanqueteambjj.github.io/inicio/login_aluno.html" class="hover:text-gray-300">√Årea do Aluno</a>
                <span class="text-gray-700">|</span>
                <button onclick="openAdminLogin()" class="hover:text-gray-300">√Årea Administrativa</button>
            </div>
            <p class="text-gray-600 text-sm mb-4">&copy; 2026 Tanque Team BJJ Academy. Todos os direitos reservados. Oss.</p>
        </div>
    </footer>

    <!-- Modals -->
    <!-- Confirmation Modal -->
    <div id="confirmationModal" class="fixed inset-0 z-[70] hidden overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-900 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 sm:mx-0 sm:h-10 sm:w-10"><i class="fa-solid fa-circle-info text-blue-600"></i></div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                            <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">Confirme seus dados</h3>
                            <div class="mt-2"><p class="text-sm text-gray-500 mb-4">Por favor, revise as informa√ß√µes antes de finalizar a matr√≠cula.</p><div id="reviewContent" class="text-sm text-gray-700 space-y-2 bg-gray-50 p-3 rounded border border-gray-200 text-left"></div></div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse gap-2">
                    <button type="button" onclick="finalizeRegistration()" id="finalConfirmBtn" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-brand-red text-base font-medium text-white hover:bg-red-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm">Tudo Certo, Matricular</button>
                    <button type="button" onclick="closeConfirmation()" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">Corrigir Dados</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="fixed inset-0 z-[80] hidden overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-900 bg-opacity-75 transition-opacity" aria-hidden="true" onclick="closeModal()"></div>
            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-green-100 sm:mx-0 sm:h-10 sm:w-10"><i class="fa-solid fa-check text-green-600"></i></div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                            <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">Matr√≠cula Pr√©-Aprovada!</h3>
                            <div class="mt-2">
                                <p class="text-sm text-gray-500">Bem-vindo √† fam√≠lia Tanque Team, <span id="modalClientName" class="font-bold"></span>!</p>
                                <p class="text-sm text-gray-500 mt-2">Sua matr√≠cula no plano <span id="modalPlanName" class="font-bold"></span> foi recebida.</p>
                                <p id="email-status-msg" class="text-sm text-green-600 mt-2 font-semibold"><i class="fa-solid fa-envelope-circle-check"></i> Voc√™ receber√° as informa√ß√µes e o contrato por e-mail.</p>
                                <div class="mt-4 bg-gray-50 p-3 rounded border border-dashed border-gray-300">
                                    <p class="text-xs text-gray-400 uppercase">Pr√≥ximo Passo:</p>
                                    <p class="text-sm font-semibold text-red-600 mb-2 uppercase">REALIZAR O PAGAMENTO NA UNIDADE OU VIA WHATSAPP NO BOT√ÉO ABAIXO</p>
                                    <a href="https://wa.me/5591998192610" target="_blank" class="block w-full text-center bg-green-100 hover:bg-green-200 text-green-800 text-sm font-bold py-2 rounded transition duration-300 border border-green-300"><i class="fa-brands fa-whatsapp mr-1"></i> Mais Informa√ß√µes / Pagamento</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" onclick="closeModal()" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-brand-red text-base font-medium text-white hover:bg-red-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm">Entendido, Oss!</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div id="admin-login-modal" class="fixed inset-0 z-[90] hidden overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-900 bg-opacity-90 transition-opacity" onclick="closeAdminLogin()"></div>
            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-md w-full p-6">
                <h3 class="text-2xl font-display font-bold text-center text-brand-dark mb-4">√ÅREA ADMINISTRATIVA</h3>
                <input type="email" id="adminEmail" placeholder="E-mail" class="w-full p-3 mb-3 border rounded">
                <input type="password" id="adminPass" placeholder="Senha" class="w-full p-3 mb-3 border rounded">
                <button onclick="checkAdminLogin()" class="w-full bg-brand-dark text-white font-bold py-3 rounded hover:bg-gray-800">ENTRAR</button>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard (Full Screen) -->
    <div id="admin-dashboard" class="fixed inset-0 z-[100] hidden bg-gray-100 overflow-y-auto">
        <div class="bg-brand-dark text-white p-4 sticky top-0 z-10 flex justify-between items-center shadow-md" id="admin-controls">
            <h2 class="font-display text-xl font-bold">PAINEL ADMINISTRATIVO - TANQUE TEAM</h2>
            <div class="flex gap-2">
                <button onclick="openAdminRegisterModal()" class="bg-green-600 px-4 py-2 rounded text-sm hover:bg-green-700"><i class="fa-solid fa-plus mr-2"></i>CADASTRAR ALUNO</button>
                <button onclick="printReport()" class="bg-blue-600 px-4 py-2 rounded text-sm hover:bg-blue-700"><i class="fa-solid fa-print mr-2"></i>IMPRIMIR RELAT√ìRIO</button>
                <button onclick="closeAdminDashboard()" class="bg-red-600 px-4 py-2 rounded text-sm hover:bg-red-700">SAIR</button>
            </div>
        </div>
        
        <div class="container mx-auto px-4 py-8">
            <!-- Stats Cards -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8 stats-container">
                <div class="bg-white p-4 rounded shadow border-l-4 border-blue-500">
                    <p class="text-gray-500 text-xs uppercase font-bold">Total Alunos</p>
                    <p class="text-2xl font-bold text-gray-800" id="stat-total">0</p>
                </div>
                <div class="bg-white p-4 rounded shadow border-l-4 border-brand-red">
                    <p class="text-gray-500 text-xs uppercase font-bold">Infantil</p>
                    <p class="text-2xl font-bold text-gray-800" id="stat-infantil">0</p>
                </div>
                <div class="bg-white p-4 rounded shadow border-l-4 border-green-500">
                    <p class="text-gray-500 text-xs uppercase font-bold">Adulto</p>
                    <p class="text-2xl font-bold text-gray-800" id="stat-adulto">0</p>
                </div>
            </div>

            <!-- Tabs -->
            <div class="flex mb-4 border-b border-gray-300 tabs-container">
                <button onclick="switchTab('adults')" id="tab-adults" class="px-6 py-2 bg-white font-bold text-brand-dark border-t border-l border-r border-gray-300 rounded-t">ADULTOS</button>
                <button onclick="switchTab('kids')" id="tab-kids" class="px-6 py-2 bg-gray-200 text-gray-600 font-bold border-b border-gray-300 rounded-t ml-2">INFANTIL</button>
            </div>

            <!-- Tables -->
            <div class="bg-white rounded shadow overflow-x-auto p-4">
                <table class="w-full text-left border-collapse">
                    <thead>
                        <tr class="bg-gray-100 text-gray-600 text-xs uppercase" id="admin-table-head">
                            <!-- Headers populated by JS -->
                        </tr>
                    </thead>
                    <tbody id="admin-table-body" class="text-sm text-gray-700">
                        <!-- Rows injected by JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Edit Modal (Admin) -->
    <div id="edit-modal" class="fixed inset-0 z-[110] hidden bg-gray-900 bg-opacity-75 flex items-center justify-center">
        <div class="bg-white rounded-lg p-6 w-full max-w-md">
            <h3 class="text-lg font-bold mb-4">Editar Aluno</h3>
            <input type="hidden" id="edit-id">
            <div class="space-y-3">
                <input type="text" id="edit-name" class="w-full border p-2 rounded" placeholder="Nome">
                <div class="grid grid-cols-2 gap-2">
                    <select id="edit-belt-color" class="w-full border p-2 rounded"><option>Branca</option><option>Cinza</option><option>Amarela</option><option>Laranja</option><option>Verde</option><option>Azul</option><option>Roxa</option><option>Marrom</option><option>Preta</option></select>
                    <select id="edit-belt-degree" class="w-full border p-2 rounded"><option value="0">0¬∫</option><option value="1">1¬∫</option><option value="2">2¬∫</option><option value="3">3¬∫</option><option value="4">4¬∫</option></select>
                </div>
                <input type="date" id="edit-end-date" class="w-full border p-2 rounded" placeholder="Fim Contrato">
                
                <!-- Payment Status Edit -->
                <label class="block text-xs uppercase text-gray-500 font-bold mt-2">Status do Pagamento</label>
                <select id="edit-payment" class="w-full border p-2 rounded">
                    <option value="Pendente">Pendente</option>
                    <option value="Em dia">Em dia</option>
                </select>

                <!-- Student Login Edit -->
                <div class="border-t pt-2 mt-2">
                    <label class="block text-xs uppercase text-gray-500 font-bold mb-1">Acesso do Aluno</label>
                    <input type="text" id="edit-student-login" class="w-full border p-2 rounded mb-2" placeholder="Login (Usu√°rio)">
                    <input type="text" id="edit-student-pass" class="w-full border p-2 rounded" placeholder="Senha">
                </div>
            </div>
            <div class="mt-4 flex justify-end gap-2">
                <button onclick="closeEditModal()" class="px-4 py-2 border rounded">Cancelar</button>
                <button onclick="saveEdit()" class="px-4 py-2 bg-blue-600 text-white rounded">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Details Modal (Admin - Read Only) -->
    <div id="details-modal" class="fixed inset-0 z-[115] hidden bg-gray-900 bg-opacity-75 flex items-center justify-center">
        <div class="bg-white rounded-lg p-6 w-full max-w-lg relative">
            <button onclick="closeDetailsModal()" class="absolute top-4 right-4 text-gray-500 hover:text-black"><i class="fa-solid fa-times"></i></button>
            <h3 class="text-xl font-display font-bold text-brand-dark mb-4 border-b pb-2">Detalhes do Aluno</h3>
            <div id="details-content" class="text-sm space-y-3">
                <!-- Injected via JS -->
            </div>
            <div class="mt-6 text-right">
                <button onclick="closeDetailsModal()" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300 font-bold text-gray-700">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Graduation Modal -->
    <div id="graduation-modal" class="fixed inset-0 z-[120] hidden bg-gray-900 bg-opacity-75 flex items-center justify-center">
        <div class="bg-white rounded-lg p-6 w-full max-w-sm text-center">
            <div class="mx-auto w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mb-4 text-yellow-600 text-2xl">
                <i class="fa-solid fa-medal"></i>
            </div>
            <h3 class="text-xl font-bold mb-2">Graduar Aluno</h3>
            <p class="text-gray-500 text-sm mb-6">Selecione a nova faixa ou grau para <span id="grad-student-name" class="font-bold"></span>.</p>
            <input type="hidden" id="grad-student-id">
            
            <div class="space-y-4 text-left">
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Nova Cor</label>
                    <select id="grad-belt-color" class="w-full border p-2 rounded"><option>Branca</option><option>Cinza</option><option>Amarela</option><option>Laranja</option><option>Verde</option><option>Azul</option><option>Roxa</option><option>Marrom</option><option>Preta</option></select>
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Novo Grau</label>
                    <select id="grad-belt-degree" class="w-full border p-2 rounded"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option></select>
                </div>
            </div>

            <div class="mt-6 flex justify-end gap-2">
                <button onclick="closeGraduationModal()" class="px-4 py-2 border rounded">Cancelar</button>
                <button onclick="saveGraduation()" class="px-4 py-2 bg-yellow-500 text-white font-bold rounded hover:bg-yellow-600">Confirmar Gradua√ß√£o</button>
            </div>
        </div>
    </div>

    <!-- Admin Register Modal -->
    <div id="admin-register-modal" class="fixed inset-0 z-[110] hidden bg-gray-900 bg-opacity-75 flex items-center justify-center">
        <div class="bg-white rounded-lg p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto">
            <h3 class="text-lg font-bold mb-4">Cadastrar Novo Aluno</h3>
            <div class="grid grid-cols-2 gap-3 text-sm">
                <div class="col-span-2"><label class="block text-gray-700 font-bold mb-1">Nome Completo</label><input type="text" id="reg-name" class="w-full border p-2 rounded"></div>
                <div><label class="block text-gray-700 font-bold mb-1">Data de Nascimento</label><input type="date" id="reg-dob" class="w-full border p-2 rounded"></div>
                <div><label class="block text-gray-700 font-bold mb-1">CPF</label><input type="text" id="reg-cpf" class="w-full border p-2 rounded"></div>
                <div class="col-span-2"><label class="block text-gray-700 font-bold mb-1">Email</label><input type="email" id="reg-email" class="w-full border p-2 rounded"></div>
                <div><label class="block text-gray-700 font-bold mb-1">Telefone</label><input type="text" id="reg-phone" class="w-full border p-2 rounded"></div>
                
                <div>
                    <label class="block text-gray-700 font-bold mb-1">Faixa</label>
                    <select id="reg-belt-color" class="w-full border p-2 rounded text-xs">
                        <option value="Branca">Branca</option><option value="Cinza">Cinza</option><option value="Amarela">Amarela</option><option value="Laranja">Laranja</option><option value="Verde">Verde</option><option value="Azul">Azul</option><option value="Roxa">Roxa</option><option value="Marrom">Marrom</option><option value="Preta">Preta</option>
                    </select>
                </div>
                <div>
                    <label class="block text-gray-700 font-bold mb-1">Grau</label>
                    <select id="reg-belt-degree" class="w-full border p-2 rounded text-xs">
                        <option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option>
                    </select>
                </div>

                <div><label class="block text-gray-700 font-bold mb-1">Plano</label><select id="reg-plan" class="w-full border p-2 rounded"><option value="infantil-mensal">Infantil Mensal</option><option value="infantil-semestral">Infantil Semestral</option><option value="adulto-mensal">Adulto Mensal</option><option value="adulto-semestral">Adulto Semestral</option></select></div>
                <div><label class="block text-gray-700 font-bold mb-1">Status Pagamento</label><select id="reg-payment" class="w-full border p-2 rounded"><option value="Em dia">Em dia</option><option value="Pendente">Pendente</option></select></div>
                <div class="col-span-2"><label class="block text-gray-700 font-bold mb-1">Endere√ßo</label><input type="text" id="reg-address" class="w-full border p-2 rounded"></div>
                <div class="col-span-2"><label class="block text-gray-700 font-bold mb-1">Respons√°vel (Se menor)</label><input type="text" id="reg-guardian" class="w-full border p-2 rounded"></div>
                
                <!-- Student Login Create -->
                <div class="col-span-2 border-t pt-2 mt-2 bg-gray-50 p-2 rounded">
                    <label class="block text-gray-700 font-bold mb-1 uppercase text-xs">Acesso do Aluno (Login)</label>
                    <div class="grid grid-cols-2 gap-2">
                        <input type="text" id="reg-student-login" class="w-full border p-2 rounded" placeholder="Usu√°rio">
                        <input type="text" id="reg-student-pass" class="w-full border p-2 rounded" placeholder="Senha">
                    </div>
                </div>
            </div>
            <div class="mt-6 flex justify-end gap-2"><button onclick="closeAdminRegisterModal()" class="px-4 py-2 border rounded">Cancelar</button><button onclick="saveAdminNewStudent()" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">Cadastrar</button></div>
        </div>
    </div>

    <!-- Printable Contract (Hidden in Web, Visible in Print) -->
    <div id="printable-contract" class="hidden bg-white text-black p-12 font-serif text-sm leading-relaxed">
        <div class="header-section text-center mb-6 border-b-2 border-black pb-4">
            <h1 class="text-2xl font-bold uppercase tracking-wider mb-1">Tanque Team BJJ</h1>
            <p class="text-xs">CNPJ: 00.000.000/0001-00</p>
            <p class="text-xs">Rua Jos√© Custodio de Almeida, N¬∫ 9 - Parque Verde - Bel√©m-PA, CEP 66635-110</p>
            <p class="text-xs">Tel: (91) 99999-9999 | Email: contato@tanqueteambjj.com</p>
        </div>
        <h2 class="text-center font-bold text-lg mb-4 uppercase underline tracking-wide">Contrato de Presta√ß√£o de Servi√ßos</h2>
        <div class="parties-section mb-6 text-xs leading-relaxed text-justify">
            <p class="mb-2"><strong>CONTRATADA:</strong> <span class="uppercase">Tanque Team Academia de Artes Marciais LTDA</span>, inscrita no CNPJ sob o n¬∫ 00.000.000/0001-00, doravante denominada <strong>ACADEMIA</strong>.</p>
            <p><strong>CONTRATANTE:</strong> <span id="printContratante" class="font-bold uppercase"></span>, inscrito(a) no CPF sob o n¬∫ <span id="printCPF" class="font-mono"></span>, residente e domiciliado(a) em <span id="printAddress" class="uppercase"></span>, Telefone <span id="printPhone"></span>, E-mail <span id="printEmail"></span>.</p>
            <p><strong>ALUNO(A):</strong> <span id="printStudent" class="font-bold uppercase"></span>, nascido(a) em <span id="printDob" class="font-mono"></span>.</p>
            <p id="printGuardianBlock" class="hidden"><strong>RESPONS√ÅVEL LEGAL:</strong> <span id="printGuardianName"></span>, CPF: <span id="printGuardianCPF"></span></p>
            <p id="printGraduation" class="hidden"><strong>GRADUA√á√ÉO:</strong> <span id="printBeltInfo" class="uppercase"></span></p>
        </div>
        <div class="clauses-section text-xs text-justify mb-6 space-y-2 leading-tight">
            <p><strong>CL√ÅUSULA 1¬™ - DO OBJETO:</strong> O presente contrato tem por objeto a presta√ß√£o de servi√ßos de ensino da arte marcial <strong>JIU-JITSU</strong> pela CONTRATADA ao ALUNO, conforme o plano escolhido, disponibilizando espa√ßo f√≠sico, instrutores capacitados e hor√°rios pr√©-estabelecidos.</p>
            <p><strong>CL√ÅUSULA 2¬™ - DO PLANO E VALOR:</strong> O ALUNO opta pelo plano <strong id="printPlan" class="uppercase bg-gray-100 px-1"></strong> <span id="printPlanCheckboxes" class="hidden"></span>, com valor mensal acordado de <strong id="printPrice" class="bg-gray-100 px-1"></strong> <span id="printContractValue" class="hidden"></span>. O pagamento dever√° ser efetuado at√© o dia <span id="printPaymentDay" class="font-bold">10</span> de cada m√™s corrente, via <span id="printPaymentMethod" class="font-bold uppercase"></span>.</p>
            <p id="printPromoNote" class="font-bold italic hidden">Obs: PROMO√á√ÉO M√äS DE INAUGURA√á√ÉO (ABRIL) - A primeira mensalidade deste contrato ser√° no valor de R$ 9,90.</p>
            <p><strong>CL√ÅUSULA 3¬™ - DAS OBRIGA√á√ïES:</strong> O ALUNO (ou seu respons√°vel) declara estar em perfeitas condi√ß√µes de sa√∫de. Compromete-se a: a) Respeitar o regulamento interno e a hierarquia; b) Manter higiene e kimono limpo; c) Zelar pelos equipamentos.</p>
            <p><strong>CL√ÅUSULA 4¬™ - DA INADIMPL√äNCIA:</strong> Atraso superior a 30 dias na mensalidade poder√° acarretar suspens√£o do acesso e cobran√ßa judicial com multa de 2% e juros.</p>
            <p><strong>CL√ÅUSULA 5¬™ - DO CANCELAMENTO:</strong> O cancelamento exige aviso pr√©vio de 30 dias por escrito. Planos anuais/semestrais possuem multa de 20% sobre parcelas vincendas.</p>
            <p><strong>CL√ÅUSULA 6¬™ - DO USO DE IMAGEM:</strong> O ALUNO (ou respons√°vel) autoriza o uso de sua imagem em materiais publicit√°rios e redes sociais da ACADEMIA.</p>
            <p><strong>CL√ÅUSULA 7¬™ - DO FORO:</strong> As partes elegem o foro de S√£o Paulo/SP para dirimir d√∫vidas deste contrato.</p>
        </div>
        <div class="signatures-section mt-8 page-break-inside-avoid">
            <p class="mb-12 text-right text-xs">Bel√©m-PA, <span id="printContractDate"></span> <span id="printDate" class="hidden"></span>.</p>
            <div class="flex justify-between gap-8">
                <div class="w-1/2 text-center"><div class="border-t border-black pt-2 mx-4"><p class="font-bold text-base signature-font mb-1">Tanque Team</p><p class="font-bold uppercase text-[10px] tracking-wider">Tanque Team BJJ</p><p class="text-[8px] text-gray-500">CONTRATADA</p></div></div>
                <div class="w-1/2 text-center"><div class="border-t border-black pt-2 mx-4"><p id="printContractSignature" class="signature-font text-xl mb-1"></p><p id="printSignature" class="hidden"></p><p class="font-bold uppercase text-[10px] tracking-wider">Assinatura do Respons√°vel/Aluno</p><p class="text-[8px] text-gray-500">CONTRATANTE (Aceite Digital)</p></div></div>
            </div>
        </div>
        <div class="mt-8 text-center text-[8px] text-gray-400 border-t pt-2">Documento gerado digitalmente em tanque-team.com.br. Validade jur√≠dica assegurada pela MP n¬∫ 2.200-2/2001.</div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        const EMAILJS_SERVICE_ID = "service_yq744mr"; 
        const EMAILJS_TEMPLATE_ID = "template_few5bna"; 
        const EMAILJS_PUBLIC_KEY = "joP6USyQXdqGI3GN5";   
        
        (function(){ emailjs.init(EMAILJS_PUBLIC_KEY); })();

        // UI Helpers
        document.getElementById('mobile-menu-btn').addEventListener('click', () => document.getElementById('mobile-menu').classList.toggle('hidden'));
        
        const cpfInput = document.getElementById('cpfInput');
        cpfInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 11) value = value.slice(0, 11);
            if (value.length > 9) value = value.replace(/^(\d{3})(\d{3})(\d{3})(\d{2}).*/, '$1.$2.$3-$4');
            else if (value.length > 6) value = value.replace(/^(\d{3})(\d{3})(\d{3}).*/, '$1.$2.$3');
            else if (value.length > 3) value = value.replace(/^(\d{3})(\d{3}).*/, '$1.$2');
            e.target.value = value;
        });

        const phoneInput = document.getElementById('phoneInput');
        phoneInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 11) value = value.slice(0, 11);
            if (value.length > 10) value = value.replace(/^(\d{2})(\d{5})(\d{4}).*/, '($1) $2-$3');
            else if (value.length > 6) value = value.replace(/^(\d{2})(\d{4})(\d{0,4}).*/, '($1) $2-$3');
            else if (value.length > 2) value = value.replace(/^(\d{2})(\d{0,5}).*/, '($1) $2');
            else value = value.replace(/^(\d*)/, '($1');
            e.target.value = value;
        });

        function toggleGraduationFields() {
            const checkBox = document.getElementById("hasGraduationCheck");
            const container = document.getElementById("graduationContainer");
            const beltColor = document.getElementById("beltColor");
            if (checkBox.checked) { container.classList.remove("hidden"); container.classList.add("grid"); beltColor.setAttribute("required", "required"); } 
            else { container.classList.add("hidden"); container.classList.remove("grid"); beltColor.removeAttribute("required"); beltColor.value = ""; document.getElementById("beltDegree").value = "0"; }
        }

        // Logic for Guardian and Plan Validation
        function validateAge() {
            const dobInput = document.getElementById('studentDob');
            const planInput = document.getElementById('selectedPlanInput');
            const msgElement = document.getElementById('age-validation-msg');

            if (!dobInput.value) return null;
            
            // Age Calculation
            const [year, month, day] = dobInput.value.split('-').map(Number);
            const dob = new Date(year, month - 1, day);
            const today = new Date();
            let age = today.getFullYear() - dob.getFullYear();
            const m = today.getMonth() - dob.getMonth();
            if (m < 0 || (m === 0 && today.getDate() < dob.getDate())) {
                age--;
            }

            // Guardian Logic
            const guardianContainer = document.getElementById('guardianContainer');
            const guardianInput = document.getElementById('guardianName');
            
            if (age < 18) {
                guardianContainer.classList.remove('hidden');
                guardianInput.setAttribute('required', 'required');
                document.getElementById('lblCpf').innerText = "CPF do Respons√°vel";
                document.getElementById('lblEmail').innerText = "E-mail do Respons√°vel";
                document.getElementById('lblPhone').innerText = "Telefone do Respons√°vel";
            } else {
                guardianContainer.classList.add('hidden');
                guardianInput.removeAttribute('required');
                guardianInput.value = "";
                document.getElementById('lblCpf').innerText = "CPF";
                document.getElementById('lblEmail').innerText = "E-mail";
                document.getElementById('lblPhone').innerText = "Telefone";
            }

            // Plan vs Age Validation
            if (planInput.value) {
                let plan = planInput.value;
                let hasConflict = false;
                let errorMsg = "";

                if (plan.includes('infantil')) {
                    if (age < 4 || age > 11) {
                        hasConflict = true;
                        errorMsg = `‚ö†Ô∏è A idade (${age} anos) n√£o corresponde ao plano INFANTIL (4 a 11 anos).`;
                    }
                } else if (plan.includes('adulto')) {
                    if (age < 12) {
                        hasConflict = true;
                        errorMsg = `‚ö†Ô∏è A idade (${age} anos) n√£o corresponde ao plano JOVEM/ADULTO (12+ anos).`;
                    }
                }

                if (hasConflict) {
                    msgElement.innerText = errorMsg;
                    msgElement.classList.remove('hidden');
                    dobInput.classList.add('border-red-500', 'ring-2', 'ring-red-500');
                } else {
                    msgElement.classList.add('hidden');
                    dobInput.classList.remove('border-red-500', 'ring-2', 'ring-red-500');
                }
            }

            return age;
        }

        function selectPlan(planName, price) {
            const summaryName = document.getElementById('summary-name');
            const summaryPrice = document.getElementById('summary-price');
            const hiddenInput = document.getElementById('selectedPlanInput');
            const promoMsg = document.getElementById('promo-msg');
            
            document.getElementById('plan-summary').classList.remove('hidden');
            let displayName = planName.replace('infantil-', 'Infantil ').replace('adulto-', 'Jovem/Adulto ').replace('mensal', 'Mensal').replace('semestral', 'Semestral').toUpperCase();
            summaryName.innerText = displayName;
            summaryPrice.innerText = `R$ ${price},00`;
            hiddenInput.value = planName;

            if(planName.includes('semestral')) promoMsg.classList.remove('hidden'); else promoMsg.classList.add('hidden');
            
            validateAge(); 
            document.getElementById('register').scrollIntoView({ behavior: 'smooth' });
        }

        function updateSignaturePreview(text) { document.getElementById('signaturePreview').innerText = text; }

        function openReviewModal(e) {
            e.preventDefault();
            const plan = document.getElementById('selectedPlanInput').value;
            if(!plan) { alert("Por favor, selecione um plano."); return; }

            const msgElement = document.getElementById('age-validation-msg');
            if (!msgElement.classList.contains('hidden')) {
                alert("Por favor, corrija o conflito entre a Idade do aluno e o Plano selecionado antes de continuar.");
                document.getElementById('studentDob').focus();
                return;
            }
            
            const age = validateAge();
            if (age === null) {
                 alert("Por favor, preencha a Data de Nascimento.");
                 return;
            }

            const studentName = document.getElementById('studentName').value;
            const studentDob = document.getElementById('studentDob').value;
            const guardianName = document.getElementById('guardianName').value;
            const needsGuardian = age < 18;
            
            const cpf = document.getElementById('cpfInput').value;
            const email = document.getElementById('emailInput').value;
            const phone = document.getElementById('phoneInput').value;
            const address = document.getElementById('addressInput').value;
            const hasGraduation = document.getElementById("hasGraduationCheck").checked;
            const beltColor = hasGraduation ? document.getElementById("beltColor").value : "Iniciante/Branca";
            const beltDegree = hasGraduation ? document.getElementById("beltDegree").value : "0";
            const graduationText = hasGraduation ? `Faixa ${beltColor} - ${beltDegree}¬∫ Grau` : "Iniciante/Faixa Branca";
            
            const paymentMethod = document.getElementById('paymentMethod').value;
            if(!paymentMethod) { alert("Por favor, selecione a Forma de Pagamento."); return; }

            let price = "R$ 0,00";
            let displayName = plan.replace('infantil-', 'Infantil ').replace('adulto-', 'Jovem/Adulto ').replace('mensal', 'Mensal').replace('semestral', 'Semestral').toUpperCase();
            
            if(plan === 'infantil-mensal') price = "R$ 179,00";
            else if(plan === 'infantil-semestral') price = "R$ 159,00";
            else if(plan === 'adulto-mensal') price = "R$ 139,00";
            else if(plan === 'adulto-semestral') price = "R$ 119,00";

            let promoNote = plan.includes('semestral') ? " (Promo√ß√£o Abril: 1¬™ Mensalidade R$ 9,90)" : "";

            const reviewHtml = `
                <p><strong>Aluno:</strong> ${studentName}</p>
                <p><strong>Nascimento:</strong> ${studentDob.split('-').reverse().join('/')}</p>
                <p><strong>Gradua√ß√£o:</strong> ${graduationText}</p>
                ${needsGuardian ? `<p><strong>Respons√°vel:</strong> ${guardianName}</p>` : ''}
                <p><strong>CPF:</strong> ${cpf}</p>
                <p><strong>E-mail:</strong> ${email}</p>
                <p><strong>Telefone:</strong> ${phone}</p>
                <p><strong>Endere√ßo:</strong> ${address}</p>
                <hr class="my-2">
                <p><strong>Plano:</strong> ${displayName}</p>
                <p><strong>Valor:</strong> ${price} <span class="text-green-600 font-bold">${promoNote}</span></p>
                <p><strong>Pagamento:</strong> ${paymentMethod}</p>
            `;
            document.getElementById('reviewContent').innerHTML = reviewHtml;
            document.getElementById('confirmationModal').classList.remove('hidden');
        }

        function closeConfirmation() { document.getElementById('confirmationModal').classList.add('hidden'); }

        // --- HELPER FUNCTION FOR CONTRACT ---
        function populateContractDOM(s, forcePrintMode = false) {
            let price = "R$ 0,00";
            if(s.plan === 'infantil-mensal') price = "R$ 179,00";
            else if(s.plan === 'infantil-semestral') price = "R$ 159,00";
            else if(s.plan === 'adulto-mensal') price = "R$ 139,00";
            else if(s.plan === 'adulto-semestral') price = "R$ 119,00";
            
            let promoNote = "";
            if (s.plan && s.plan.includes('semestral')) {
                // If it's old data, it might not have registration date object ready
                const regDate = s.registrationDate ? new Date(s.registrationDate) : new Date();
                if (regDate.getMonth() === 3) { 
                     promoNote = "(PROMO√á√ÉO ABRIL: 1¬™ Mensalidade R$ 9,90)";
                }
            }

            let dobDate;
            if (s.dob && s.dob.includes('T')) {
                 dobDate = new Date(s.dob);
            } else if (s.dob) {
                 const [y, m, d] = s.dob.split('-').map(Number);
                 dobDate = new Date(y, m - 1, d);
            } else {
                 dobDate = new Date();
            }
            
            const formattedDob = `${dobDate.getDate().toString().padStart(2,'0')}/${(dobDate.getMonth()+1).toString().padStart(2,'0')}/${dobDate.getFullYear()}`;
            
            document.getElementById('printContratante').innerText = s.guardian || s.name;
            document.getElementById('printStudent').innerText = s.name;
            document.getElementById('printDob').innerText = formattedDob;
            document.getElementById('printCPF').innerText = s.cpf || "";
            document.getElementById('printEmail').innerText = s.email || "";
            document.getElementById('printPhone').innerText = s.phone || "";
            document.getElementById('printAddress').innerText = s.address || "";
            
            const displayName = s.plan ? s.plan.replace('infantil-', 'Infantil ').replace('adulto-', 'Jovem/Adulto ').replace('mensal', 'Mensal').replace('semestral', 'Semestral').toUpperCase() : 'N√ÉO INFORMADO';
            document.getElementById('printPlan').innerText = displayName;
            document.getElementById('printPrice').innerText = price + " " + promoNote;
            
            document.getElementById('printPaymentMethod').innerText = s.paymentMethod || "DEFINIDO NO ATO";
            
            const printGraduation = document.getElementById('printGraduation');
            if(s.belt && !s.belt.includes("Branca - 0¬∫ Grau") && !s.belt.includes("Iniciante")) {
                printGraduation.classList.remove('hidden');
                document.getElementById('printBeltInfo').innerText = s.belt;
            } else {
                 printGraduation.classList.add('hidden');
            }
            
            const regDate = s.registrationDate ? new Date(s.registrationDate) : new Date();
            const options = { day: 'numeric', month: 'long', year: 'numeric' };
            document.getElementById('printContractDate').innerText = regDate.toLocaleDateString('pt-BR', options);
            document.getElementById('printContractSignature').innerText = s.signature || ""; 
            
            document.getElementById('printPaymentDay').innerText = regDate.getDate();
            const planCheckboxes = s.plan && s.plan.includes('mensal') ? '(X) MENSAL ( ) SEMESTRAL' : '( ) MENSAL (X) SEMESTRAL';
            document.getElementById('printPlanCheckboxes').innerText = planCheckboxes;
            document.getElementById('printContractValue').innerText = price;
            
            const guardianBlock = document.getElementById('printGuardianBlock');
            if (s.guardian) {
                guardianBlock.classList.remove('hidden');
                document.getElementById('printGuardianName').innerText = s.guardian;
                document.getElementById('printGuardianCPF').innerText = s.cpf; // Assumed responsible CPF
            } else {
                guardianBlock.classList.add('hidden');
            }
        }


        async function finalizeRegistration() {
            const confirmBtn = document.getElementById('finalConfirmBtn');
            const originalBtnText = "Tudo Certo, Matricular";
            
            confirmBtn.innerText = "Processando...";
            confirmBtn.disabled = true;
            confirmBtn.classList.add('opacity-75', 'cursor-not-allowed');

            try {
                const today = new Date();
                
                const plan = document.getElementById('selectedPlanInput').value;
                const studentName = document.getElementById('studentName').value;
                const studentDob = document.getElementById('studentDob').value;
                const age = validateAge();
                const needsGuardian = age < 18;
                const guardianName = needsGuardian ? document.getElementById('guardianName').value : "";
                
                const cpf = document.getElementById('cpfInput').value;
                const email = document.getElementById('emailInput').value;
                const phone = document.getElementById('phoneInput').value;
                const address = document.getElementById('addressInput').value;
                const signature = document.getElementById('signatureInput').value;
                const paymentMethod = document.getElementById('paymentMethod').value;
                const contratanteName = needsGuardian ? guardianName : studentName;

                let price = "R$ 0,00";
                let displayName = plan.replace('infantil-', 'Infantil ').replace('adulto-', 'Jovem/Adulto ').replace('mensal', 'Mensal').replace('semestral', 'Semestral').toUpperCase();
                
                if(plan === 'infantil-mensal') price = "R$ 179,00";
                if(plan === 'infantil-semestral') price = "R$ 159,00";
                if(plan === 'adulto-mensal') price = "R$ 139,00";
                if(plan === 'adulto-semestral') price = "R$ 119,00";

                let promoNote = "";
                const isPromo = plan.includes('semestral');
                if (isPromo) promoNote = "(PROMO√á√ÉO ABRIL: 1¬™ Mensalidade R$ 9,90)";

                const hasGraduation = document.getElementById("hasGraduationCheck").checked;
                const beltColor = hasGraduation ? document.getElementById("beltColor").value : "Branca";
                const beltDegree = hasGraduation ? document.getElementById("beltDegree").value : "0";
                const graduationText = `Faixa ${beltColor} - ${beltDegree}¬∫ Grau`;

                const dobParts = studentDob.split('-');
                const formattedDob = `${dobParts[2]}/${dobParts[1]}/${dobParts[0]}`;

                const regDate = new Date();
                let endDate = new Date(regDate);
                if(plan.includes('mensal')) endDate.setMonth(endDate.getMonth() + 1);
                else endDate.setMonth(endDate.getMonth() + 6);

                const studentData = {
                    name: studentName,
                    dob: studentDob,
                    cpf: cpf,
                    belt: graduationText,
                    plan: plan,
                    category: plan.includes('infantil') ? 'Infantil' : 'Adulto',
                    registrationDate: regDate.toISOString(),
                    contractEndDate: endDate.toISOString(),
                    email: email,
                    phone: phone,
                    address: address,
                    guardian: guardianName,
                    paymentStatus: 'Pendente',
                    paymentMethod: paymentMethod,
                    signature: signature
                };

                try {
                    if (window.firebaseInitialized && window.addDoc) {
                        await window.addDoc(window.collection(window.db, 'artifacts', window.appId, 'public', 'data', 'students'), studentData);
                    }
                } catch(err) {
                    console.error("Erro ao salvar no banco (continuando fluxo):", err);
                }

                document.getElementById('modalClientName').innerText = studentName; 
                document.getElementById('modalPlanName').innerText = displayName;

                // --- EMAIL SENDING ---
                const messageStudent = `<div style="font-family: Arial, sans-serif; color: #333; max-width: 600px; margin: 0 auto;"><div style="text-align: center; margin-bottom: 20px; background-color: #000; padding: 20px; border-radius: 8px 8px 0 0;"><img src="https://i.ibb.co/spgfD2Nd/1771300330359.png" alt="Tanque Team BJJ" style="width: 100px; height: auto;"><h2 style="color: #fff; margin: 10px 0 0 0;">TANQUE TEAM BJJ</h2></div><h2 style="color: #D90429;">Ol√°, ${studentName}!</h2><p>√â com grande satisfa√ß√£o que confirmamos a sua matr√≠cula na <strong>Tanque Team BJJ</strong>! üëä</p><p>Voc√™ acaba de dar o primeiro passo na sua jornada no Jiu-Jitsu. Mais do que t√©cnica, aqui voc√™ encontrar√° disciplina, fam√≠lia e um tatame preparado para o seu desenvolvimento.</p><div style="background-color: #f8f9fa; border-left: 5px solid #D90429; padding: 15px; margin: 20px 0; border-radius: 4px;"><h3 style="margin-top: 0; color: #D90429; border-bottom: 1px solid #ddd; padding-bottom: 10px;">‚úÖ Resumo da sua Matr√≠cula</h3><p style="margin: 5px 0;"><strong>Aluno:</strong> ${studentName}</p><p style="margin: 5px 0;"><strong>Plano:</strong> ${displayName}</p><p style="margin: 5px 0;"><strong>Valor:</strong> ${price} <span style="color: #D90429; font-weight: bold;">${promoNote}</span></p><p style="margin: 5px 0;"><strong>Pagamento:</strong> ${paymentMethod}</p><p style="margin: 5px 0;"><strong>Nascimento:</strong> ${formattedDob}</p><p style="margin: 5px 0;"><strong>Gradua√ß√£o:</strong> ${graduationText}</p><hr style="border: 0; border-top: 1px solid #eee; margin: 10px 0;">${needsGuardian ? `<p style="margin: 5px 0;"><strong>Respons√°vel:</strong> ${guardianName}</p>` : ''}<p style="margin: 5px 0;"><strong>CPF:</strong> ${cpf}</p><p style="margin: 5px 0;"><strong>Email:</strong> ${email}</p><p style="margin: 5px 0;"><strong>Telefone:</strong> ${phone}</p><p style="margin: 5px 0;"><strong>Endere√ßo:</strong> ${address}</p></div><div style="background-color: #fff3cd; color: #856404; padding: 15px; border-radius: 4px; margin-bottom: 20px; border: 1px solid #ffeeba;"><h3 style="margin-top: 0;">üí∞ Informa√ß√£o de Pagamento</h3><p style="margin: 0;">Para concluir a ativa√ß√£o do seu plano e retirar seu patch, por favor realize o pagamento <strong>presencialmente na unidade</strong> ou entre em contato atrav√©s do nosso <strong>WhatsApp</strong>.</p></div><h3 style="color: #D90429;">üìã Pr√≥ximos Passos:</h3><ul><li style="margin-bottom: 8px;"><strong>Uniforme:</strong> Caso ainda n√£o tenha, nossa equipe est√° pronta para ajudar com o seu kimono.</li><li style="margin-bottom: 8px;"><strong>Primeiro Treino:</strong> Chegue 15 minutos antes para se ambientar e conhecer o professor.</li><li style="margin-bottom: 8px;"><strong>Higiene:</strong> Lembre-se de trazer chinelos para circular fora do tatame.</li></ul><div style="background-color: #e8f5e9; padding: 15px; border-radius: 8px; margin-top: 20px;"><p style="margin: 0;"><strong>üìç Localiza√ß√£o:</strong> <a href="https://maps.app.goo.gl/Qr4yLUTsVaZPiery9" style="color: #2e7d32; text-decoration: none;">Rua Jos√© Custodio de Almeida, N¬∫ 9 - Parque Verde - Bel√©m-PA</a></p></div><p style="margin-top: 20px;">Se tiver d√∫vidas, responda a este e-mail ou entre em contato pelo WhatsApp: <a href="https://wa.me/5591998192610" style="color: #25D366; font-weight: bold; text-decoration: none;">(91) 99819-2610</a>.</p><p style="font-size: 1.2em;">Estamos ansiosos para te ver no tatame!<br><strong>OSS!</strong></p><hr style="border: 0; border-top: 1px solid #ccc; margin: 30px 0;"><p style="font-size: 12px; color: #777; text-align: center;">Atenciosamente,<br>Equipe Tanque Team BJJ</p></div>`;

                const messageAdmin = `NOVA MATR√çCULA REALIZADA (C√≥pia Admin):\n-----------------------------------\nAluno: ${studentName}\nNascimento: ${formattedDob}\nGradua√ß√£o: ${graduationText}\n${needsGuardian ? `Respons√°vel: ${guardianName}` : ''}\nCPF: ${cpf}\nEmail: ${email}\nTelefone: ${phone}\nEndere√ßo: ${address}\n\nDETALHES DO PLANO:\n-----------------------------------\nPlano: ${displayName}\nValor: ${price} ${promoNote}\nPagamento: ${paymentMethod}\nData: ${today.toLocaleDateString('pt-BR')}\n\nStatus: Contrato Assinado Digitalmente.`;

                const paramsStudent = { to_name: contratanteName, to_email: email, plan_name: displayName, reply_to: 'contato@tanqueteambjj.com', subject: `ü•ã Bem-vindo √† Fam√≠lia! Confirma√ß√£o de Matr√≠cula - ${studentName}`, message: messageStudent };
                const paramsAdmin = { to_name: "Administra√ß√£o", to_email: 'cledson.sales@gmail.com', plan_name: displayName, reply_to: email, subject: `Nova Matr√≠cula: ${studentName} - ${displayName}`, message: messageAdmin };

                const timeoutPromise = new Promise((_, reject) => setTimeout(() => reject(new Error("Timeout")), 7000));
                
                const emailPromise = Promise.all([
                    emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, paramsStudent, EMAILJS_PUBLIC_KEY),
                    emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, paramsAdmin, EMAILJS_PUBLIC_KEY)
                ]);

                try {
                     await Promise.race([emailPromise, timeoutPromise]);
                     const emailMsg = document.getElementById('email-status-msg');
                     if(emailMsg) { emailMsg.className = "text-sm text-green-600 mt-2 font-semibold"; emailMsg.innerHTML = `<i class="fa-solid fa-envelope-circle-check"></i> Matr√≠cula confirmada! E-mail enviado para ${email}.`; }
                } catch (e) {
                     console.log("Email status:", e.message); 
                     const emailMsg = document.getElementById('email-status-msg');
                     if(emailMsg) { emailMsg.className = "text-sm text-red-600 mt-2 font-semibold bg-red-100 p-2 rounded border border-red-200"; emailMsg.innerHTML = '<i class="fa-solid fa-triangle-exclamation"></i> <strong>Aviso:</strong> A matr√≠cula foi gerada, mas houve uma demora no envio do e-mail.'; }
                }

                closeConfirmation();
                document.getElementById('successModal').classList.remove('hidden');

            } catch (e) {
                alert("Erro inesperado: " + e.message);
            } finally {
                confirmBtn.innerText = originalBtnText;
                confirmBtn.disabled = false;
                confirmBtn.classList.remove('opacity-75', 'cursor-not-allowed');
            }
        }

        function closeModal() {
            document.getElementById('successModal').classList.add('hidden');
            document.getElementById('registrationForm').reset();
            document.getElementById('plan-summary').classList.add('hidden');
            document.getElementById('signaturePreview').innerText = '';
            document.getElementById('guardianContainer').classList.add('hidden');
            toggleGraduationFields();
        }

        // --- ADMIN AREA LOGIC ---
        function openAdminLogin() { document.getElementById('admin-login-modal').classList.remove('hidden'); }
        function closeAdminLogin() { document.getElementById('admin-login-modal').classList.add('hidden'); }
        
        async function checkAdminLogin() {
            const email = document.getElementById('adminEmail').value;
            const pass = document.getElementById('adminPass').value;
            
            if(email === "administracao@tanqueteambjj.com.br" && pass === "32573515") {
                closeAdminLogin();
                document.getElementById('admin-dashboard').classList.remove('hidden');
                if(window.firebaseInitialized) {
                    await loadAdminData();
                } else {
                    alert("Banco de dados n√£o dispon√≠vel. Verifique a conex√£o.");
                }
            } else {
                alert("Credenciais inv√°lidas");
            }
        }

        function closeAdminDashboard() { document.getElementById('admin-dashboard').classList.add('hidden'); }

        let allStudents = [];
        let currentTab = 'adults';

        async function loadAdminData() {
            try {
                const q = window.collection(window.db, 'artifacts', window.appId, 'public', 'data', 'students');
                const snapshot = await window.getDocs(q);
                allStudents = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
                
                allStudents.sort((a, b) => new Date(b.registrationDate) - new Date(a.registrationDate));
                
                renderTable();
                updateStats();
            } catch(e) {
                console.error("Erro ao carregar dados:", e);
                alert(`Erro ao carregar lista de alunos: ${e.message}`);
            }
        }

        function getAge(dob) {
            const birth = new Date(dob);
            const diff = Date.now() - birth.getTime();
            const ageDate = new Date(diff);
            return Math.abs(ageDate.getUTCFullYear() - 1970);
        }

        function formatDate(isoDate) {
            if(!isoDate) return '-';
            const d = new Date(isoDate);
            return d.toLocaleDateString('pt-BR');
        }

        function updateStats() {
            document.getElementById('stat-total').innerText = allStudents.length;
            document.getElementById('stat-infantil').innerText = allStudents.filter(s => s.category === 'Infantil').length;
            document.getElementById('stat-adulto').innerText = allStudents.filter(s => s.category === 'Adulto').length;
        }

        function switchTab(tab) {
            currentTab = tab;
            const tabA = document.getElementById('tab-adults');
            const tabK = document.getElementById('tab-kids');
            
            if(tab === 'adults') {
                tabA.className = "px-6 py-2 bg-white font-bold text-brand-dark border-t border-l border-r border-gray-300 rounded-t";
                tabK.className = "px-6 py-2 bg-gray-200 text-gray-600 font-bold border-b border-gray-300 rounded-t ml-2";
            } else {
                tabK.className = "px-6 py-2 bg-white font-bold text-brand-dark border-t border-l border-r border-gray-300 rounded-t ml-2";
                tabA.className = "px-6 py-2 bg-gray-200 text-gray-600 font-bold border-b border-gray-300 rounded-t";
            }
            renderTable();
        }

        function printReport() {
            document.body.classList.add('printing-report');
            window.print();
            document.body.classList.remove('printing-report');
        }

        // New function to print individual student contract (Admin)
        function printIndividualContract(id) {
            const s = allStudents.find(st => st.id === id);
            if (!s) { alert("Aluno n√£o encontrado."); return; }
            populateContractDOM(s);
            window.print();
        }

        // Helper to generate SVG Belt
        function renderBeltSVG(beltStr) {
            if (!beltStr) return '';
            
            const colors = {
                'Branca': '#ffffff', 'Cinza': '#9ca3af', 'Amarela': '#fbbf24', 
                'Laranja': '#f97316', 'Verde': '#10b981', 'Azul': '#3b82f6', 
                'Roxa': '#8b5cf6', 'Marrom': '#78350f', 'Preta': '#000000'
            };

            let color = '#ffffff'; // Default White
            let degree = 0;
            let colorName = 'Branca';

            for (const [name, hex] of Object.entries(colors)) {
                if (beltStr.includes(name)) {
                    color = hex;
                    colorName = name;
                    break;
                }
            }

            const degreeMatch = beltStr.match(/(\d)¬∫/);
            if (degreeMatch) degree = parseInt(degreeMatch[1]);

            const width = 100;
            const height = 24;
            const tipWidth = 25;
            const stripeWidth = 4;
            const stripeGap = 3;

            let stripesSVG = '';
            
            const barColor = (colorName === 'Preta') ? '#dc2626' : '#000000';
            const stripeColor = '#ffffff';

            for (let i = 0; i < degree; i++) {
                const x = width - 5 - (i * (stripeWidth + stripeGap)) - stripeWidth;
                stripesSVG += `<rect x="${x}" y="0" width="${stripeWidth}" height="${height}" fill="${stripeColor}" />`;
            }

            return `
                <svg width="${width}" height="${height}" class="shadow-sm rounded" style="border:1px solid #ddd">
                    <rect x="0" y="0" width="${width}" height="${height}" fill="${color}" />
                    <rect x="${width - tipWidth}" y="0" width="${tipWidth}" height="${height}" fill="${barColor}" />
                    ${stripesSVG}
                </svg>
            `;
        }

        function renderTable() {
            const tbody = document.getElementById('admin-table-body');
            const theadRow = document.getElementById('admin-table-head');
            tbody.innerHTML = '';
            
            const categoryFilter = currentTab === 'adults' ? 'Adulto' : 'Infantil';
            
            let headerHTML = `
                <th class="p-3 border-b">Nome</th>
                <th class="p-3 border-b">Faixa</th>
                <th class="p-3 border-b">Telefone</th>
                <th class="p-3 border-b">Fim Contrato</th>
                <th class="p-3 border-b text-center">Pagamento</th>
                <th class="p-3 border-b text-center no-print-col">A√ß√µes</th>
            `;
            theadRow.innerHTML = headerHTML;

            const filtered = allStudents.filter(s => s.category === categoryFilter);

            filtered.forEach(s => {
                const tr = document.createElement('tr');
                tr.className = "border-b hover:bg-gray-50";
                
                const payStatus = s.paymentStatus || 'Pendente';
                const payClass = payStatus === 'Em dia' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';

                const endDate = new Date(s.contractEndDate);
                const today = new Date();
                const timeDiff = endDate - today;
                const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24));
                
                let dateClass = 'text-green-600'; 
                if (daysDiff < 0) dateClass = 'text-red-600 font-bold';
                else if (daysDiff <= 5) dateClass = 'text-yellow-600 font-extrabold';

                let rowHTML = `
                    <td class="p-3 align-middle font-medium">${s.name}</td>
                    <td class="p-3 align-middle" title="${s.belt || 'Branca'}">
                        ${renderBeltSVG(s.belt || 'Faixa Branca - 0¬∫ Grau')}
                    </td>
                    <td class="p-3 align-middle text-sm">${s.phone}</td>
                    <td class="p-3 align-middle text-sm ${dateClass}">${formatDate(s.contractEndDate)}</td>
                    <td class="p-3 text-center align-middle"><span class="px-2 py-1 rounded text-xs font-bold ${payClass}">${payStatus}</span></td>
                    <td class="p-3 text-center no-print-col align-middle">
                        <button onclick="viewStudentDetails('${s.id}')" class="text-gray-600 hover:text-black mr-2" title="Mais Informa√ß√µes"><i class="fa-solid fa-eye"></i></button>
                        <button onclick="printIndividualContract('${s.id}')" class="text-gray-600 hover:text-black mr-2" title="Imprimir Contrato"><i class="fa-solid fa-file-contract"></i></button>
                        <button onclick="openGraduationModal('${s.id}', '${s.name}')" class="text-yellow-600 hover:text-yellow-800 mr-2" title="Graduar"><i class="fa-solid fa-medal"></i></button>
                        <button onclick="editStudent('${s.id}')" class="text-blue-600 hover:text-blue-800 mr-2" title="Editar"><i class="fa-solid fa-pen"></i></button>
                        <button onclick="deleteStudent('${s.id}')" class="text-red-600 hover:text-red-800" title="Excluir"><i class="fa-solid fa-trash"></i></button>
                    </td>
                `;
                
                tr.innerHTML = rowHTML;
                tbody.appendChild(tr);
            });
        }

        function viewStudentDetails(id) {
            const s = allStudents.find(st => st.id === id);
            if (!s) return;
            
            const content = `
                <div class="grid grid-cols-2 gap-4">
                    <div class="col-span-2 text-center pb-4 border-b border-gray-100">
                        <h4 class="text-xl font-bold text-gray-800">${s.name}</h4>
                        <p class="text-xs text-gray-500 uppercase tracking-wide">${s.category} | ${getAge(s.dob)} anos</p>
                        <div class="flex justify-center mt-2">${renderBeltSVG(s.belt)}</div>
                        <p class="text-xs text-gray-400 mt-1">${s.belt}</p>
                    </div>

                    <div>
                        <p class="text-xs text-gray-500 font-bold uppercase">CPF</p>
                        <p class="text-sm font-mono bg-gray-50 p-1 rounded">${s.cpf}</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500 font-bold uppercase">Nascimento</p>
                        <p class="text-sm bg-gray-50 p-1 rounded">${formatDate(s.dob)}</p>
                    </div>

                    <div class="col-span-2">
                        <p class="text-xs text-gray-500 font-bold uppercase">E-mail</p>
                        <p class="text-sm bg-gray-50 p-1 rounded">${s.email}</p>
                    </div>
                    
                    <div>
                        <p class="text-xs text-gray-500 font-bold uppercase">Telefone</p>
                        <p class="text-sm bg-gray-50 p-1 rounded">${s.phone}</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500 font-bold uppercase">Pagamento</p>
                        <p class="text-sm font-bold ${s.paymentStatus === 'Em dia' ? 'text-green-600' : 'text-red-600'}">${s.paymentStatus || 'Pendente'}</p>
                    </div>

                    <div class="col-span-2">
                        <p class="text-xs text-gray-500 font-bold uppercase">Endere√ßo</p>
                        <p class="text-sm bg-gray-50 p-1 rounded">${s.address}</p>
                    </div>

                    <div class="col-span-2 border-t pt-2 mt-2">
                        <p class="text-xs text-gray-500 font-bold uppercase">Plano</p>
                        <p class="text-sm font-bold text-brand-red">${s.plan ? s.plan.toUpperCase().replace('-', ' ') : '-'}</p>
                        <p class="text-xs text-gray-400">Vence em: ${formatDate(s.contractEndDate)}</p>
                        <p class="text-xs text-gray-400">M√©todo: ${s.paymentMethod || 'N√£o informado'}</p>
                    </div>

                    ${s.guardian ? `
                    <div class="col-span-2 bg-yellow-50 p-2 rounded border border-yellow-100">
                        <p class="text-xs text-yellow-700 font-bold uppercase">Respons√°vel Legal</p>
                        <p class="text-sm text-yellow-900">${s.guardian}</p>
                    </div>` : ''}
                    
                    ${s.studentLogin ? `
                    <div class="col-span-2 bg-blue-50 p-2 rounded border border-blue-100 mt-2">
                        <p class="text-xs text-blue-700 font-bold uppercase">Login do Aluno</p>
                        <p class="text-sm text-blue-900">Usu√°rio: ${s.studentLogin} <span class="text-gray-400 mx-2">|</span> Senha: ${s.studentPassword}</p>
                    </div>` : ''}
                </div>
            `;
            
            document.getElementById('details-content').innerHTML = content;
            document.getElementById('details-modal').classList.remove('hidden');
        }

        function closeDetailsModal() { document.getElementById('details-modal').classList.add('hidden'); }

        async function deleteStudent(id) {
            if(confirm("Tem certeza que deseja excluir este aluno?")) {
                await window.deleteDoc(window.doc(window.db, 'artifacts', window.appId, 'public', 'data', 'students', id));
                loadAdminData();
            }
        }

        function editStudent(id) {
            const s = allStudents.find(st => st.id === id);
            if(!s) return;
            
            document.getElementById('edit-id').value = id;
            document.getElementById('edit-name').value = s.name;
            
            document.getElementById('edit-end-date').value = s.contractEndDate.split('T')[0];
            document.getElementById('edit-payment').value = s.paymentStatus || 'Pendente';
            
            document.getElementById('edit-student-login').value = s.studentLogin || '';
            document.getElementById('edit-student-pass').value = s.studentPassword || '';

            document.getElementById('edit-modal').classList.remove('hidden');
        }

        function closeEditModal() { document.getElementById('edit-modal').classList.add('hidden'); }

        async function saveEdit() {
            const id = document.getElementById('edit-id').value;
            const newName = document.getElementById('edit-name').value;
            
            const beltColor = document.getElementById("edit-belt-color").value;
            const beltDegree = document.getElementById("edit-belt-degree").value;
            const newBelt = `Faixa ${beltColor} - ${beltDegree}¬∫ Grau`;

            const newDateStr = document.getElementById('edit-end-date').value;
            const newPayment = document.getElementById('edit-payment').value;
            
            const newLogin = document.getElementById('edit-student-login').value;
            const newPass = document.getElementById('edit-student-pass').value;

            const [y, m, d] = newDateStr.split('-').map(Number);
            const dateObj = new Date(y, m - 1, d, 12, 0, 0);

            await window.updateDoc(window.doc(window.db, 'artifacts', window.appId, 'public', 'data', 'students', id), {
                name: newName,
                belt: newBelt,
                contractEndDate: dateObj.toISOString(),
                paymentStatus: newPayment,
                studentLogin: newLogin,
                studentPassword: newPass
            });
            
            closeEditModal();
            loadAdminData();
        }

        function openAdminRegisterModal() { document.getElementById('admin-register-modal').classList.remove('hidden'); }
        function closeAdminRegisterModal() { document.getElementById('admin-register-modal').classList.add('hidden'); }

        async function saveAdminNewStudent() {
             const name = document.getElementById('reg-name').value;
            const dob = document.getElementById('reg-dob').value;
            const cpf = document.getElementById('reg-cpf').value;
            const email = document.getElementById('reg-email').value;
            const phone = document.getElementById('reg-phone').value;
            
            const beltColor = document.getElementById('reg-belt-color').value;
            const beltDegree = document.getElementById('reg-belt-degree').value;
            const belt = `Faixa ${beltColor} - ${beltDegree}¬∫ Grau`;
            
            const plan = document.getElementById('reg-plan').value;
            const paymentStatus = document.getElementById('reg-payment').value;
            const address = document.getElementById('reg-address').value;
            const guardian = document.getElementById('reg-guardian').value;
            
            const studentLogin = document.getElementById('reg-student-login').value;
            const studentPass = document.getElementById('reg-student-pass').value;

            if(!name || !dob || !plan) {
                alert("Nome, Data de Nascimento e Plano s√£o obrigat√≥rios.");
                return;
            }

            const regDate = new Date();
            let endDate = new Date(regDate);
            if(plan.includes('mensal')) endDate.setMonth(endDate.getMonth() + 1);
            else endDate.setMonth(endDate.getMonth() + 6);

            const studentData = {
                name: name,
                dob: dob,
                cpf: cpf,
                belt: belt,
                plan: plan,
                category: plan.includes('infantil') ? 'Infantil' : 'Adulto',
                registrationDate: regDate.toISOString(),
                contractEndDate: endDate.toISOString(),
                email: email,
                phone: phone,
                address: address,
                guardian: guardian,
                paymentStatus: paymentStatus,
                studentLogin: studentLogin,
                studentPassword: studentPass
            };

            try {
                if (window.firebaseInitialized && window.addDoc) {
                    await window.addDoc(window.collection(window.db, 'artifacts', window.appId, 'public', 'data', 'students'), studentData);
                    alert("Aluno cadastrado com sucesso!");
                    closeAdminRegisterModal();
                    loadAdminData();
                } else {
                    alert("Erro: Banco de dados n√£o conectado.");
                }
            } catch(err) {
                console.error("Erro ao salvar:", err);
                alert("Erro ao salvar aluno: " + err.message);
            }
        }

        // --- GRADUATION MODAL ---
        function openGraduationModal(id, name) {
            document.getElementById('grad-student-id').value = id;
            document.getElementById('grad-student-name').innerText = name;
            document.getElementById('graduation-modal').classList.remove('hidden');
        }

        function closeGraduationModal() { document.getElementById('graduation-modal').classList.add('hidden'); }

        async function saveGraduation() {
            const id = document.getElementById('grad-student-id').value;
            const color = document.getElementById('grad-belt-color').value;
            const degree = document.getElementById('grad-belt-degree').value;
            const newBeltStr = `Faixa ${color} - ${degree}¬∫ Grau`;

            try {
                await window.updateDoc(window.doc(window.db, 'artifacts', window.appId, 'public', 'data', 'students', id), {
                    belt: newBeltStr
                });
                alert(`Aluno graduado para ${newBeltStr}!`);
                closeGraduationModal();
                loadAdminData();
            } catch(e) {
                alert("Erro ao graduar: " + e.message);
            }
        }

    </script>
</body>
</html>
